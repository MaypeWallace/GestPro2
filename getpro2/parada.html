<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Premium de Registro de Paradas</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #8b5cf6;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --success: #10b981;
            --bg-light: #ffffff;
            --bg-dark: #1f2937;
            --text-light: #374151;
            --text-dark: #f9fafb;
            --border-light: #e5e7eb;
            --border-dark: #374151;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        .dark {
            --primary: #60a5fa;
            --primary-dark: #3b82f6;
        }
        
        /* Estilos personalizados */
        .premium-card {
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        }
        
        .premium-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .dark .glass-effect {
            background: rgba(31, 41, 55, 0.4);
        }
        
        .premium-button {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .premium-button:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            transition: all 0.5s ease;
        }
        
        .premium-button:hover:after {
            width: 100%;
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
            width: 100%;
        }
        
        /* Tooltip personalizado */
        .custom-tooltip {
            position: absolute;
            background: var(--bg-light);
            color: var(--text-light);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .dark .custom-tooltip {
            background: var(--bg-dark);
            color: var(--text-dark);
        }
        
        /* Animações de transição */
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Estilos para o menu lateral */
        .sidebar {
            transition: all 0.3s ease;
        }
        
        .sidebar-collapsed {
            width: 80px;
        }
        
        .sidebar-expanded {
            width: 250px;
        }
        
        /* Toggle switcher */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        /* Animação de carregamento */
        .loader {
            border-top-color: var(--primary);
            animation: spinner 0.8s linear infinite;
        }
        
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-light);
        }
        
        .dark ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* Ripple effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple:after {
            content: "";
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform .5s, opacity 1s;
        }
        
        .ripple:active:after {
            transform: scale(0, 0);
            opacity: .3;
            transition: 0s;
        }
        
        /* Menu dropdown personalizado */
        .dropdown-menu {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
        }
        
        .dropdown-active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Overlay de Carregamento -->
    <div id="loading-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl flex flex-col items-center">
            <div class="loader w-12 h-12 border-4 border-gray-300 dark:border-gray-600 rounded-full"></div>
            <p id="loading-text" class="mt-4 text-lg font-medium">Carregando...</p>
        </div>
    </div>
    
    <!-- Tutorial/Ajuda Modal -->
    <div id="help-modal" class="fixed inset-0 z-40 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative max-w-4xl mx-auto mt-10 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-primary dark:text-primary-dark">
                        <i class="fas fa-question-circle mr-2"></i>Tutorial do Sistema
                    </h2>
                    <button id="close-help" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-6 overflow-y-auto max-h-[70vh] pr-2">
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Introdução</h3>
                        <p>Este sistema foi desenvolvido para registrar e analisar paradas de máquinas na fábrica. Ele permite acompanhar os motivos das paradas, tempos de inatividade e gerar relatórios detalhados.</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Seleção de Máquina</h3>
                        <p>Na tela inicial, selecione a máquina para a qual deseja registrar uma parada. Você verá todas as máquinas disponíveis em forma de cards.</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Registrando uma Parada</h3>
                        <ol class="list-decimal ml-5 space-y-2">
                            <li>Preencha a data da parada (por padrão, é a data atual)</li>
                            <li>Selecione o setor responsável</li>
                            <li>Escolha o operador (filtrado por setor)</li>
                            <li>Selecione o motivo da parada</li>
                            <li>Escolha a ocorrência específica</li>
                            <li>Informe a duração da parada em minutos</li>
                            <li>Se necessário, adicione observações</li>
                            <li>Clique em "Registrar Parada"</li>
                        </ol>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Dashboard</h3>
                        <p>O dashboard apresenta gráficos e estatísticas sobre as paradas:</p>
                        <ul class="list-disc ml-5 space-y-1">
                            <li>Distribuição por motivos</li>
                            <li>Tempo total de parada por máquina</li>
                            <li>Histórico de paradas por período</li>
                            <li>Tendências e comparativos</li>
                        </ul>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Exportação de Dados</h3>
                        <p>Para exportar os dados de paradas:</p>
                        <ul class="list-disc ml-5 space-y-1">
                            <li>Use o botão "Exportar PDF" para gerar um relatório em PDF</li>
                            <li>Use o botão "Exportar Excel" para gerar uma planilha detalhada</li>
                            <li>Para transferir dados entre máquinas, use o botão "Exportar/Importar Dados"</li>
                        </ul>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Área Administrativa</h3>
                        <p>O painel administrativo permite configurar o sistema:</p>
                        <ul class="list-disc ml-5 space-y-1">
                            <li>Gerenciar máquinas (adicionar, editar, remover)</li>
                            <li>Configurar motivos de paradas e seus códigos</li>
                            <li>Gerenciar setores e operadores</li>
                            <li>Definir atribuições de operadores às máquinas</li>
                            <li>Configurar preferências como unidade de tempo (minutos/horas)</li>
                        </ul>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Transferência de Dados</h3>
                        <p>Para transferir dados entre máquinas:</p>
                        <ol class="list-decimal ml-5 space-y-2">
                            <li>Na máquina de origem, clique em "Exportar Dados"</li>
                            <li>Salve o arquivo JSON gerado</li>
                            <li>Na máquina de destino, clique em "Importar Dados"</li>
                            <li>Selecione o arquivo JSON salvo anteriormente</li>
                            <li>Escolha se deseja substituir ou mesclar os dados existentes</li>
                        </ol>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-primary dark:text-primary-dark">Dicas e Boas Práticas</h3>
                        <ul class="list-disc ml-5 space-y-1">
                            <li>Registre as paradas imediatamente após ocorrerem para maior precisão</li>
                            <li>Use as observações para detalhar circunstâncias específicas</li>
                            <li>Exporte backups regularmente para evitar perda de dados</li>
                            <li>Consulte o dashboard regularmente para identificar tendências e problemas recorrentes</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-300 dark:border-gray-600 flex justify-end">
                    <button id="close-help-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors premium-button">
                        Entendi
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Config/Preferências Modal -->
    <div id="config-modal" class="fixed inset-0 z-40 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative max-w-2xl mx-auto mt-10 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-primary dark:text-primary-dark">
                        <i class="fas fa-cog mr-2"></i>Configurações do Sistema
                    </h2>
                    <button id="close-config" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Aparência</h3>
                        <div class="flex items-center justify-between">
                            <span>Modo Escuro</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dark-mode-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Unidade de Tempo</h3>
                        <div class="flex items-center justify-between">
                            <span>Usar horas em vez de minutos</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="time-unit-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Altera como o tempo de parada é registrado e exibido no sistema.</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Vinculação de Operadores</h3>
                        <div class="flex items-center justify-between">
                            <span>Vincular operadores às máquinas (em vez de setores)</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="operator-binding-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Altera como os operadores são atribuídos e filtrados no sistema.</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-lg font-medium mb-3">Exportação de Dados</h3>
                        <div class="flex flex-col space-y-2">
                            <button id="export-all-data" class="text-left px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors premium-button">
                                <i class="fas fa-file-export mr-2"></i>Exportar Todos os Dados
                            </button>
                            <button id="import-data" class="text-left px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors premium-button">
                                <i class="fas fa-file-import mr-2"></i>Importar Dados
                            </button>
                            <input type="file" id="import-file" class="hidden" accept=".json">
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-300 dark:border-gray-600 flex justify-end">
                    <button id="close-config-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors premium-button">
                        Salvar Alterações
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="fixed inset-0 z-40 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative max-w-md mx-auto mt-20 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-primary dark:text-primary-dark">
                        <i class="fas fa-lock mr-2"></i>Acesso Administrativo
                    </h2>
                    <button id="close-admin-login" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="admin-login-form" class="space-y-4">
                    <div>
                        <label for="admin-password" class="block text-sm font-medium mb-1">Senha de Administrador</label>
                        <input type="password" id="admin-password" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Digite a senha de admin">
                    </div>
                    
                    <div id="admin-error" class="text-red-500 text-sm hidden">
                        Senha incorreta. Tente novamente.
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancel-admin-login" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary premium-button">
                            Entrar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Tela de seleção de máquina (inicial) -->
    <div id="selecao-maquina" class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-primary dark:text-primary-dark">Sistema de Registro de Paradas</h1>
            <div class="flex space-x-2">
                <button id="help-btn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary-dark rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" title="Ajuda">
                    <i class="fas fa-question-circle text-xl"></i>
                </button>
                <button id="config-btn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary-dark rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" title="Configurações">
                    <i class="fas fa-cog text-xl"></i>
                </button>
                <button id="admin-btn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary-dark rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" title="Admin">
                    <i class="fas fa-user-shield text-xl"></i>
                </button>
            </div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl premium-card p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-6 text-center">Selecione a Máquina</h2>
            
            <div id="machines-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                <!-- As máquinas serão carregadas aqui via JavaScript -->
            </div>
        </div>
        
        <footer class="text-center text-sm text-gray-500 dark:text-gray-400 mt-8">
            <p>&copy; 2025 Sistema de Registro de Paradas de Máquina. Todos os direitos reservados.</p>
            <p class="mt-1">Desenvolvido pela Fábrica de Software (TI)</p>
        </footer>
    </div>

    <!-- Aplicativo principal -->
    <div id="app-principal" class="hidden">
        <div class="flex">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar sidebar-expanded h-screen bg-white dark:bg-gray-800 shadow-lg fixed left-0 top-0 z-30 transition-all duration-300 overflow-hidden">
                <div class="px-4 py-6">
                    <div class="flex items-center justify-between mb-8">
                        <a href="#" class="flex items-center space-x-3">
                            <i class="fas fa-cogs text-primary dark:text-primary-dark text-2xl"></i>
                            <span class="sidebar-text text-xl font-bold">Paradas</span>
                        </a>
                        <button id="toggle-sidebar" class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-bars text-primary dark:text-primary-dark"></i>
                        </button>
                    </div>
                    
                    <nav class="mt-6">
                        <ul class="space-y-2">
                            <li>
                                <button id="nav-registro" class="w-full flex items-center py-3 px-4 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-primary dark:text-primary-dark">
                                    <i class="fas fa-clipboard-list w-6"></i>
                                    <span class="sidebar-text ml-3">Registro</span>
                                </button>
                            </li>
                            <li>
                                <button id="nav-historico" class="w-full flex items-center py-3 px-4 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-history w-6"></i>
                                    <span class="sidebar-text ml-3">Histórico</span>
                                </button>
                            </li>
                            <li>
                                <button id="nav-dashboard" class="w-full flex items-center py-3 px-4 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-chart-pie w-6"></i>
                                    <span class="sidebar-text ml-3">Dashboard</span>
                                </button>
                            </li>
                            <li>
                                <button id="nav-relatorios" class="w-full flex items-center py-3 px-4 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-file-alt w-6"></i>
                                    <span class="sidebar-text ml-3">Relatórios</span>
                                </button>
                            </li>
                            <li class="pt-6 mt-6 border-t border-gray-200 dark:border-gray-700">
                                <button id="nav-config" class="w-full flex items-center py-3 px-4 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-cog w-6"></i>
                                    <span class="sidebar-text ml-3">Configurações</span>
                                </button>
                            </li>
                            <li>
                                <button id="nav-admin" class="w-full flex items-center py-3 px-4 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-user-shield w-6"></i>
                                    <span class="sidebar-text ml-3">Admin</span>
                                </button>
                            </li>
                            <li>
                                <button id="nav-voltar" class="w-full flex items-center py-3 px-4 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-arrow-left w-6"></i>
                                    <span class="sidebar-text ml-3">Voltar</span>
                                </button>
                            </li>
                        </ul>
                    </nav>
                </div>
            </aside>
            
            <!-- Conteúdo principal -->
            <main id="main-content" class="flex-1 transition-all duration-300 ml-64 p-6 bg-gray-50 dark:bg-gray-900 min-h-screen">
                <!-- Header do Conteúdo -->
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold">
                            <span id="page-title">Registro de Paradas</span>: 
                            <span id="maquina-selecionada" class="text-primary dark:text-primary-dark"></span>
                        </h1>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-2">
                            <button id="export-data-btn" class="p-2 bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors" title="Exportar/Importar Dados">
                                <i class="fas fa-file-export"></i>
                            </button>
                            <div id="export-dropdown" class="absolute right-0 mt-2 py-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-xl z-20 hidden">
                                <button id="export-json" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left">
                                    <i class="fas fa-file-export mr-2"></i>Exportar Dados
                                </button>
                                <button id="import-json" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left">
                                    <i class="fas fa-file-import mr-2"></i>Importar Dados
                                </button>
                            </div>
                        </div>
                        <button id="help-button" class="p-2 bg-purple-100 text-purple-600 dark:bg-purple-900 dark:text-purple-300 rounded-full hover:bg-purple-200 dark:hover:bg-purple-800 transition-colors" title="Ajuda">
                            <i class="fas fa-question-circle"></i>
                        </button>
                        <button id="theme-toggle" class="p-2 bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Alternar Tema">
                            <i id="theme-icon" class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Seção de Registro (visível por padrão) -->
                <section id="section-registro" class="fade-in">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg premium-card mb-8">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold mb-6 border-b pb-2 border-gray-200 dark:border-gray-700">Novo Registro de Parada</h2>
                            
                            <form id="parada-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <div>
                                        <label for="data" class="block text-sm font-medium mb-1">Data da Parada*</label>
                                        <input type="date" id="data" name="data" 
                                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                    </div>
                                    
                                    <div id="setor-container">
                                        <label for="setor" class="block text-sm font-medium mb-1">Setor*</label>
                                        <select id="setor" name="setor" 
                                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                            <option value="">Selecione o setor</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="operador" class="block text-sm font-medium mb-1">Operador*</label>
                                        <select id="operador" name="operador" 
                                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                            <option value="">Selecione o operador</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="motivo" class="block text-sm font-medium mb-1">Motivo da Parada*</label>
                                        <select id="motivo" name="motivo" 
                                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                            <option value="">Selecione um motivo</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="ocorrencia" class="block text-sm font-medium mb-1">Ocorrência Específica*</label>
                                        <select id="ocorrencia" name="ocorrencia" 
                                                class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                            <option value="">Selecione uma ocorrência</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="duracao" class="block text-sm font-medium mb-1">Duração (<span id="unidade-tempo">minutos</span>)*</label>
                                        <input type="number" id="duracao" name="duracao" min="1" step="any"
                                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="observacoes" class="block text-sm font-medium mb-1">Observações</label>
                                    <textarea id="observacoes" name="observacoes" rows="3" placeholder="Detalhes adicionais sobre a parada"
                                              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700"></textarea>
                                </div>
                                
                                <div class="flex justify-end pt-2">
                                    <button type="submit" 
                                            class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                        <i class="fas fa-save mr-2"></i>Registrar Parada
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
                
                <!-- Seção de Histórico (oculta por padrão) -->
                <section id="section-historico" class="hidden fade-in">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg premium-card">
                        <div class="p-6">
                            <div class="flex flex-wrap justify-between items-center mb-6 border-b pb-2 border-gray-200 dark:border-gray-700">
                                <h2 class="text-xl font-semibold">Histórico de Paradas</h2>
                                <div class="flex flex-wrap gap-2">
                                    <button id="btn-exportar-pdf" class="px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-colors premium-button">
                                        <i class="fas fa-file-pdf mr-1"></i>PDF
                                    </button>
                                    <button id="btn-exportar-excel" class="px-3 py-1 bg-green-500 text-white rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors premium-button">
                                        <i class="fas fa-file-excel mr-1"></i>Excel
                                    </button>
                                    <button id="refresh-registros" class="px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-colors premium-button">
                                        <i class="fas fa-sync-alt mr-1"></i>Atualizar
                                    </button>
                                    <button id="limpar-filtros" class="px-3 py-1 bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 transition-colors premium-button">
                                        <i class="fas fa-filter-circle-xmark mr-1"></i>Limpar Filtros
                                    </button>
                                    <button id="limpar-dados" class="px-3 py-1 bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 rounded-md hover:bg-red-200 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50 transition-colors premium-button">
                                        <i class="fas fa-trash-alt mr-1"></i>Limpar Dados
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Filtros -->
                            <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label for="filtro-data" class="block text-sm font-medium mb-1">Filtrar por Data</label>
                                        <input type="date" id="filtro-data" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800">
                                    </div>
                                    <div>
                                        <label for="filtro-motivo" class="block text-sm font-medium mb-1">Filtrar por Motivo</label>
                                        <select id="filtro-motivo" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800">
                                            <option value="">Todos os motivos</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="filtro-operador" class="block text-sm font-medium mb-1">Filtrar por Operador</label>
                                        <select id="filtro-operador" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800">
                                            <option value="">Todos os operadores</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Setor</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Operador</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Código</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Motivo</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ocorrência</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Duração</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-registros" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Os registros serão inseridos aqui via JavaScript -->
                                    </tbody>
                                </table>
                                
                                <div id="sem-registros" class="py-8 text-center text-gray-500 dark:text-gray-400 hidden">
                                    <i class="fas fa-clipboard-list text-4xl mb-3 opacity-50"></i>
                                    <p class="text-lg">Nenhum registro de parada encontrado.</p>
                                    <p class="text-sm mt-2">Registre uma nova parada ou ajuste os filtros de busca.</p>
                                </div>
                                
                                <!-- Paginação -->
                                <div class="flex items-center justify-between border-t border-gray-200 dark:border-gray-700 px-4 py-3 sm:px-6">
                                    <div class="flex justify-between flex-1 sm:hidden">
                                        <button id="prev-page-mobile" class="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            Anterior
                                        </button>
                                        <button id="next-page-mobile" class="ml-3 relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                                            Próxima
                                        </button>
                                    </div>
                                    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                        <div>
                                            <p class="text-sm text-gray-700 dark:text-gray-300">
                                                Mostrando <span id="page-start">0</span> a <span id="page-end">0</span> de <span id="total-items">0</span> resultados
                                            </p>
                                        </div>
                                        <div>
                                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                                <button id="prev-page" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700">
                                                    <span class="sr-only">Anterior</span>
                                                    <i class="fas fa-chevron-left"></i>
                                                </button>
                                                <div id="pagination-numbers" class="flex">
                                                    <!-- Números de página serão inseridos aqui -->
                                                </div>
                                                <button id="next-page" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700">
                                                    <span class="sr-only">Próxima</span>
                                                    <i class="fas fa-chevron-right"></i>
                                                </button>
                                            </nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Seção de Dashboard (oculta por padrão) -->
                <section id="section-dashboard" class="hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <!-- Cards de Estatísticas -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total de Paradas</p>
                                    <h3 id="total-paradas" class="text-3xl font-bold mt-1">0</h3>
                                </div>
                                <div class="p-3 bg-blue-100 text-blue-500 dark:bg-blue-900 dark:text-blue-300 rounded-lg">
                                    <i class="fas fa-clipboard-list text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    <span id="percentual-paradas" class="font-medium text-green-500">0%</span> em relação ao mês anterior
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Tempo Total Parado</p>
                                    <h3 id="tempo-total-parado" class="text-3xl font-bold mt-1">0 min</h3>
                                </div>
                                <div class="p-3 bg-red-100 text-red-500 dark:bg-red-900 dark:text-red-300 rounded-lg">
                                    <i class="fas fa-clock text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    <span id="percentual-tempo" class="font-medium text-red-500">0%</span> em relação ao mês anterior
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Motivo Mais Frequente</p>
                                    <h3 id="motivo-frequente" class="text-3xl font-bold mt-1">-</h3>
                                </div>
                                <div class="p-3 bg-yellow-100 text-yellow-500 dark:bg-yellow-900 dark:text-yellow-300 rounded-lg">
                                    <i class="fas fa-exclamation-triangle text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div id="motivo-ocorrencias" class="text-sm text-gray-500 dark:text-gray-400">
                                    0 ocorrências (0%)
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Parada Mais Longa</p>
                                    <h3 id="parada-longa" class="text-3xl font-bold mt-1">0 min</h3>
                                </div>
                                <div class="p-3 bg-purple-100 text-purple-500 dark:bg-purple-900 dark:text-purple-300 rounded-lg">
                                    <i class="fas fa-hourglass-end text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div id="parada-longa-info" class="text-sm text-gray-500 dark:text-gray-400">
                                    -
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Gráficos -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <h3 class="text-lg font-semibold mb-4">Distribuição por Motivos</h3>
                            <div class="chart-container">
                                <canvas id="motivos-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <h3 class="text-lg font-semibold mb-4">Tempo Total por Dia (Últimos 7 dias)</h3>
                            <div class="chart-container">
                                <canvas id="tempo-diario-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <h3 class="text-lg font-semibold mb-4">Tempo de Parada por Ocorrência</h3>
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="ocorrencias-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Seção de Relatórios (oculta por padrão) -->
                <section id="section-relatorios" class="hidden fade-in">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Cards de Relatórios -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <div class="flex flex-col h-full">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-lg font-semibold">Relatório Diário</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Resumo das paradas nas últimas 24 horas</p>
                                    </div>
                                    <div class="p-3 bg-blue-100 text-blue-500 dark:bg-blue-900 dark:text-blue-300 rounded-lg">
                                        <i class="fas fa-calendar-day text-xl"></i>
                                    </div>
                                </div>
                                <div class="flex-grow">
                                    <div class="text-sm text-gray-600 dark:text-gray-400">
                                        <div><span class="font-medium">Paradas:</span> <span id="relatorio-diario-paradas">0</span></div>
                                        <div><span class="font-medium">Tempo total:</span> <span id="relatorio-diario-tempo">0 min</span></div>
                                        <div><span class="font-medium">Motivo principal:</span> <span id="relatorio-diario-motivo">-</span></div>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <button class="export-relatorio-diario w-full px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors premium-button">
                                        <i class="fas fa-file-export mr-2"></i>Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <div class="flex flex-col h-full">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-lg font-semibold">Relatório Semanal</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Análise das paradas nos últimos 7 dias</p>
                                    </div>
                                    <div class="p-3 bg-green-100 text-green-500 dark:bg-green-900 dark:text-green-300 rounded-lg">
                                        <i class="fas fa-calendar-week text-xl"></i>
                                    </div>
                                </div>
                                <div class="flex-grow">
                                    <div class="text-sm text-gray-600 dark:text-gray-400">
                                        <div><span class="font-medium">Paradas:</span> <span id="relatorio-semanal-paradas">0</span></div>
                                        <div><span class="font-medium">Tempo total:</span> <span id="relatorio-semanal-tempo">0 min</span></div>
                                        <div><span class="font-medium">Motivo principal:</span> <span id="relatorio-semanal-motivo">-</span></div>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <button class="export-relatorio-semanal w-full px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors premium-button">
                                        <i class="fas fa-file-export mr-2"></i>Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                            <div class="flex flex-col h-full">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-lg font-semibold">Relatório Mensal</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Visão completa do mês atual</p>
                                    </div>
                                    <div class="p-3 bg-purple-100 text-purple-500 dark:bg-purple-900 dark:text-purple-300 rounded-lg">
                                        <i class="fas fa-calendar-alt text-xl"></i>
                                    </div>
                                </div>
                                <div class="flex-grow">
                                    <div class="text-sm text-gray-600 dark:text-gray-400">
                                        <div><span class="font-medium">Paradas:</span> <span id="relatorio-mensal-paradas">0</span></div>
                                        <div><span class="font-medium">Tempo total:</span> <span id="relatorio-mensal-tempo">0 min</span></div>
                                        <div><span class="font-medium">Motivo principal:</span> <span id="relatorio-mensal-motivo">-</span></div>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <button class="export-relatorio-mensal w-full px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-colors premium-button">
                                        <i class="fas fa-file-export mr-2"></i>Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card mb-6">
                        <h3 class="text-lg font-semibold mb-4">Relatório Personalizado</h3>
                        
                        <form id="relatorio-personalizado-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="relatorio-data-inicio" class="block text-sm font-medium mb-1">Data Inicial</label>
                                    <input type="date" id="relatorio-data-inicio" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                </div>
                                <div>
                                    <label for="relatorio-data-fim" class="block text-sm font-medium mb-1">Data Final</label>
                                    <input type="date" id="relatorio-data-fim" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                </div>
                                <div>
                                    <label for="relatorio-tipo" class="block text-sm font-medium mb-1">Formato</label>
                                    <select id="relatorio-tipo" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700">
                                        <option value="pdf">PDF</option>
                                        <option value="excel">Excel</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="relatorio-motivo" class="block text-sm font-medium mb-1">Filtrar por Motivo</label>
                                    <select id="relatorio-motivo" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700">
                                        <option value="">Todos os motivos</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="relatorio-operador" class="block text-sm font-medium mb-1">Filtrar por Operador</label>
                                    <select id="relatorio-operador" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700">
                                        <option value="">Todos os operadores</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                    <i class="fas fa-file-export mr-2"></i>Gerar Relatório
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 premium-card">
                        <h3 class="text-lg font-semibold mb-4">Histórico de Relatórios</h3>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome</th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Gerado em</th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tipo</th>
                                        <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="historico-relatorios" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Dados serão inseridos via JavaScript -->
                                </tbody>
                            </table>
                            
                            <div id="sem-relatorios" class="py-6 text-center text-gray-500 dark:text-gray-400">
                                <p>Nenhum relatório gerado recentemente.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <!-- Modal de Detalhes de Parada -->
    <div id="modal-detalhes" class="fixed inset-0 z-40 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative max-w-lg mx-auto mt-20 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-primary dark:text-primary-dark">
                        <i class="fas fa-info-circle mr-2"></i>Detalhes da Parada
                    </h2>
                    <button id="fechar-detalhes" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="modal-conteudo" class="space-y-4">
                    <!-- Conteúdo do modal será inserido aqui -->
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end">
                    <button id="fechar-modal" class="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-colors">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Confirmação (genérico) -->
    <div id="modal-confirmacao" class="fixed inset-0 z-40 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative max-w-md mx-auto mt-20 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="p-6">
                <div class="mb-6">
                    <h2 id="confirmacao-titulo" class="text-xl font-bold text-gray-800 dark:text-gray-200">
                        Confirmação
                    </h2>
                </div>
                
                <div id="confirmacao-mensagem" class="text-gray-600 dark:text-gray-400">
                    Tem certeza que deseja continuar?
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
                    <button id="confirmar-cancelar" class="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-colors">
                        Cancelar
                    </button>
                    <button id="confirmar-confirmar" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-colors premium-button">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Painel Admin -->
    <div id="painel-admin" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative w-full max-w-7xl mx-auto mt-10 mb-10 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="flex h-full">
                <!-- Sidebar Admin -->
                <div class="w-64 bg-gray-50 dark:bg-gray-900 p-4 border-r border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between mb-8">
                        <h2 class="text-xl font-bold text-primary dark:text-primary-dark">Painel Admin</h2>
                        <button id="fechar-admin" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <ul class="space-y-2">
                        <li>
                            <button id="admin-tab-maquinas" class="w-full flex items-center py-2 px-4 rounded-md bg-primary text-white hover:bg-primary-dark transition-colors">
                                <i class="fas fa-cogs w-6"></i>
                                <span class="ml-2">Máquinas</span>
                            </button>
                        </li>
                        <li>
                            <button id="admin-tab-motivos" class="w-full flex items-center py-2 px-4 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                                <i class="fas fa-exclamation-triangle w-6"></i>
                                <span class="ml-2">Motivos de Parada</span>
                            </button>
                        </li>
                        <li>
                            <button id="admin-tab-ocorrencias" class="w-full flex items-center py-2 px-4 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                                <i class="fas fa-clipboard-list w-6"></i>
                                <span class="ml-2">Ocorrências</span>
                            </button>
                        </li>
                        <li>
                            <button id="admin-tab-setores" class="w-full flex items-center py-2 px-4 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                                <i class="fas fa-building w-6"></i>
                                <span class="ml-2">Setores</span>
                            </button>
                        </li>
                        <li>
                            <button id="admin-tab-operadores" class="w-full flex items-center py-2 px-4 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                                <i class="fas fa-users w-6"></i>
                                <span class="ml-2">Operadores</span>
                            </button>
                        </li>
                        <li>
                            <button id="admin-tab-atribuicoes" class="w-full flex items-center py-2 px-4 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                                <i class="fas fa-user-tag w-6"></i>
                                <span class="ml-2">Atribuições</span>
                            </button>
                        </li>
                        <li>
                            <button id="admin-tab-configuracoes" class="w-full flex items-center py-2 px-4 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                                <i class="fas fa-sliders-h w-6"></i>
                                <span class="ml-2">Configurações</span>
                            </button>
                        </li>
                    </ul>
                </div>
                
                <!-- Conteúdo Admin -->
                <div class="flex-1 p-6 overflow-y-auto max-h-[calc(100vh-8rem)]">
                    <!-- Seção de Máquinas (visível por padrão) -->
                    <div id="admin-secao-maquinas" class="fade-in">
                        <h2 class="text-2xl font-bold mb-6">Gerenciar Máquinas</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Adicionar Máquina</h3>
                            
                            <form id="form-add-maquina" class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="nova-maquina" class="block text-sm font-medium mb-1">Nome/Código da Máquina</label>
                                        <input type="text" id="nova-maquina" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Ex: LM 1" required>
                                    </div>
                                    <div class="flex items-end">
                                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                            <i class="fas fa-plus mr-2"></i>Adicionar
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold mb-4">Máquinas Cadastradas</h3>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Máquina</th>
                                            <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-maquinas" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- As máquinas serão listadas aqui -->
                                    </tbody>
                                </table>
                                
                                <div id="sem-maquinas" class="py-4 text-center text-gray-500 dark:text-gray-400 hidden">
                                    <p>Nenhuma máquina cadastrada.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Motivos de Parada (oculta por padrão) -->
                    <div id="admin-secao-motivos" class="hidden fade-in">
                        <h2 class="text-2xl font-bold mb-6">Gerenciar Motivos de Parada</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Adicionar/Editar Motivo</h3>
                            
                            <form id="form-add-motivo" class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div>
                                        <label for="motivo-codigo" class="block text-sm font-medium mb-1">Código</label>
                                        <input type="number" id="motivo-codigo" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Ex: 10" min="1" required>
                                    </div>
                                    <div>
                                        <label for="motivo-descricao" class="block text-sm font-medium mb-1">Descrição</label>
                                        <input type="text" id="motivo-descricao" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Ex: Ajustes" required>
                                    </div>
                                    <div class="flex items-end">
                                        <input type="hidden" id="motivo-id" value="">
                                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                            <i class="fas fa-save mr-2"></i><span id="btn-motivo-text">Adicionar</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold mb-4">Motivos Cadastrados</h3>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Código</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Descrição</th>
                                            <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-motivos" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Os motivos serão listados aqui -->
                                    </tbody>
                                </table>
                                
                                <div id="sem-motivos" class="py-4 text-center text-gray-500 dark:text-gray-400 hidden">
                                    <p>Nenhum motivo cadastrado.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Ocorrências (oculta por padrão) -->
                    <div id="admin-secao-ocorrencias" class="hidden fade-in">
                        <h2 class="text-2xl font-bold mb-6">Gerenciar Ocorrências</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Adicionar/Editar Ocorrência</h3>
                            
                            <form id="form-add-ocorrencia" class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-4 gap-4">
                                    <div>
                                        <label for="ocorrencia-motivo" class="block text-sm font-medium mb-1">Motivo</label>
                                        <select id="ocorrencia-motivo" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                            <option value="">Selecione o motivo</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="ocorrencia-codigo" class="block text-sm font-medium mb-1">Código</label>
                                        <input type="number" id="ocorrencia-codigo" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Ex: 101" min="1" required>
                                    </div>
                                    <div>
                                        <label for="ocorrencia-descricao" class="block text-sm font-medium mb-1">Descrição</label>
                                        <input type="text" id="ocorrencia-descricao" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Ex: Ajuste de Pressão" required>
                                    </div>
                                    <div class="flex items-end">
                                        <input type="hidden" id="ocorrencia-id" value="">
                                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                            <i class="fas fa-save mr-2"></i><span id="btn-ocorrencia-text">Adicionar</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold mb-4">Ocorrências Cadastradas</h3>
                            
                            <div class="mb-4">
                                <label for="filtro-ocorrencias-motivo" class="block text-sm font-medium mb-1">Filtrar por Motivo</label>
                                <select id="filtro-ocorrencias-motivo" class="w-full sm:w-64 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700">
                                    <option value="">Todos os motivos</option>
                                </select>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Código</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Motivo</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Descrição</th>
                                            <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-ocorrencias" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- As ocorrências serão listadas aqui -->
                                    </tbody>
                                </table>
                                
                                <div id="sem-ocorrencias" class="py-4 text-center text-gray-500 dark:text-gray-400 hidden">
                                    <p>Nenhuma ocorrência cadastrada.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Setores (oculta por padrão) -->
                    <div id="admin-secao-setores" class="hidden fade-in">
                        <h2 class="text-2xl font-bold mb-6">Gerenciar Setores</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Adicionar/Editar Setor</h3>
                            
                            <form id="form-add-setor" class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="setor-nome" class="block text-sm font-medium mb-1">Nome do Setor</label>
                                        <input type="text" id="setor-nome" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Ex: Manutenção" required>
                                    </div>
                                    <div class="flex items-end">
                                        <input type="hidden" id="setor-id" value="">
                                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                            <i class="fas fa-save mr-2"></i><span id="btn-setor-text">Adicionar</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold mb-4">Setores Cadastrados</h3>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome do Setor</th>
                                            <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-setores" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Os setores serão listados aqui -->
                                    </tbody>
                                </table>
                                
                                <div id="sem-setores" class="py-4 text-center text-gray-500 dark:text-gray-400 hidden">
                                    <p>Nenhum setor cadastrado.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Operadores (oculta por padrão) -->
                    <div id="admin-secao-operadores" class="hidden fade-in">
                        <h2 class="text-2xl font-bold mb-6">Gerenciar Operadores</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Adicionar/Editar Operador</h3>
                            
                            <form id="form-add-operador" class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="operador-nome" class="block text-sm font-medium mb-1">Nome do Operador</label>
                                        <input type="text" id="operador-nome" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Ex: João Silva" required>
                                    </div>
                                    <div class="flex items-end">
                                        <input type="hidden" id="operador-id" value="">
                                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                            <i class="fas fa-save mr-2"></i><span id="btn-operador-text">Adicionar</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold mb-4">Operadores Cadastrados</h3>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome do Operador</th>
                                            <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-operadores" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Os operadores serão listados aqui -->
                                    </tbody>
                                </table>
                                
                                <div id="sem-operadores" class="py-4 text-center text-gray-500 dark:text-gray-400 hidden">
                                    <p>Nenhum operador cadastrado.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Atribuições (oculta por padrão) -->
                    <div id="admin-secao-atribuicoes" class="hidden fade-in">
                        <h2 class="text-2xl font-bold mb-6">Gerenciar Atribuições</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Associar Operador</h3>
                            
                            <form id="form-add-atribuicao" class="space-y-4">
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div>
                                        <label id="label-atribuicao-maquina-setor" for="atribuicao-maquina-setor" class="block text-sm font-medium mb-1">Máquina</label>
                                        <select id="atribuicao-maquina-setor" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                            <option value="">Selecione</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="atribuicao-operador" class="block text-sm font-medium mb-1">Operador</label>
                                        <select id="atribuicao-operador" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" required>
                                            <option value="">Selecione o operador</option>
                                        </select>
                                    </div>
                                    <div class="flex items-end">
                                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                            <i class="fas fa-link mr-2"></i>Associar
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold mb-4">Atribuições Cadastradas</h3>
                            
                            <div class="mb-4">
                                <label id="label-filtro-atribuicoes" for="filtro-atribuicoes" class="block text-sm font-medium mb-1">Filtrar por Máquina</label>
                                <select id="filtro-atribuicoes" class="w-full sm:w-64 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700">
                                    <option value="">Todas</option>
                                </select>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th id="th-atribuicao-maquina-setor" scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Máquina</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Operador</th>
                                            <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-atribuicoes" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- As atribuições serão listadas aqui -->
                                    </tbody>
                                </table>
                                
                                <div id="sem-atribuicoes" class="py-4 text-center text-gray-500 dark:text-gray-400 hidden">
                                    <p>Nenhuma atribuição cadastrada.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Configurações (oculta por padrão) -->
                    <div id="admin-secao-configuracoes" class="hidden fade-in">
                        <h2 class="text-2xl font-bold mb-6">Configurações do Sistema</h2>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Preferências Gerais</h3>
                            
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">Unidade de Tempo</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Altera como o tempo de parada é registrado e exibido</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="admin-time-unit-toggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">Vinculação de Operadores</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Vincular operadores às máquinas em vez de setores</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="admin-operator-binding-toggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">Senha de Administrador</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Alterar a senha de acesso ao painel administrativo</p>
                                    </div>
                                    <button id="alterar-senha-admin" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 transition-colors premium-button">
                                        Alterar Senha
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Backup e Restauração</h3>
                            
                            <div class="space-y-4">
                                <button id="admin-export-all" class="w-full px-4 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-colors premium-button flex items-center justify-center">
                                    <i class="fas fa-download mr-2"></i>Fazer Backup Completo
                                </button>
                                
                                <div class="relative">
                                    <input type="file" id="admin-import-file" class="hidden" accept=".json">
                                    <button id="admin-import-all" class="w-full px-4 py-3 bg-green-500 text-white rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors premium-button flex items-center justify-center">
                                        <i class="fas fa-upload mr-2"></i>Restaurar a partir de Backup
                                    </button>
                                </div>
                                
                                <button id="admin-reset-all" class="w-full px-4 py-3 bg-red-500 text-white rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-colors premium-button flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Resetar Sistema
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Alterar Senha -->
    <div id="modal-alterar-senha" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        <div class="relative max-w-md mx-auto mt-20 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-primary dark:text-primary-dark">
                        <i class="fas fa-key mr-2"></i>Alterar Senha
                    </h2>
                    <button id="fechar-alterar-senha" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="form-alterar-senha" class="space-y-4">
                    <div>
                        <label for="senha-atual" class="block text-sm font-medium mb-1">Senha Atual</label>
                        <input type="password" id="senha-atual" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Digite a senha atual" required>
                    </div>
                    <div>
                        <label for="nova-senha" class="block text-sm font-medium mb-1">Nova Senha</label>
                        <input type="password" id="nova-senha" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Digite a nova senha" required>
                    </div>
                    <div>
                        <label for="confirmar-senha" class="block text-sm font-medium mb-1">Confirmar Nova Senha</label>
                        <input type="password" id="confirmar-senha" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700" placeholder="Confirme a nova senha" required>
                    </div>
                    
                    <div id="senha-erro" class="text-red-500 text-sm hidden">
                        As senhas não coincidem ou a senha atual está incorreta.
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelar-alterar-senha" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary premium-button">
                            Alterar Senha
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Constantes e variáveis globais
            const ADMIN_PASSWORD_KEY = 'admin_password';
            const DEFAULT_ADMIN_PASSWORD = 'admin';
            const TIME_UNIT_KEY = 'time_unit';
            const OPERATOR_BINDING_KEY = 'operator_binding';
            let maquinaAtiva = '';
            let currentPage = 1;
            let itemsPerPage = 10;
            let motivosCache = [];
            let ocorrenciasCache = [];
            let confirmCallback = null;
            
            // Verifica se já existe uma senha de admin salva
            if (!localStorage.getItem(ADMIN_PASSWORD_KEY)) {
                localStorage.setItem(ADMIN_PASSWORD_KEY, DEFAULT_ADMIN_PASSWORD);
            }
            
            // Configurações padrão
            if (!localStorage.getItem(TIME_UNIT_KEY)) {
                localStorage.setItem(TIME_UNIT_KEY, 'minutos');
            }
            
            if (!localStorage.getItem(OPERATOR_BINDING_KEY)) {
                localStorage.setItem(OPERATOR_BINDING_KEY, 'false');
            }
            
            // Inicializa dados padrão se o sistema for novo
            inicializarDadosPadrao();
            
            // Atualiza os elementos da interface com base nas configurações
            atualizarInterfaceConfiguracoes();
            
            // Inicializa a data atual no campo de data
            const dataAtual = new Date();
            const anoAtual = dataAtual.getFullYear();
            const mesAtual = String(dataAtual.getMonth() + 1).padStart(2, '0');
            const diaAtual = String(dataAtual.getDate()).padStart(2, '0');
            document.getElementById('data').value = `${anoAtual}-${mesAtual}-${diaAtual}`;
            
            // Carrega a lista de máquinas na tela inicial
            carregarSelecaoMaquinas();
            
            // Event Listeners - Navegação Principal
            document.getElementById('toggle-sidebar').addEventListener('click', toggleSidebar);
            document.getElementById('nav-registro').addEventListener('click', () => navegarPara('registro'));
            document.getElementById('nav-historico').addEventListener('click', () => navegarPara('historico'));
            document.getElementById('nav-dashboard').addEventListener('click', () => navegarPara('dashboard'));
            document.getElementById('nav-relatorios').addEventListener('click', () => navegarPara('relatorios'));
            document.getElementById('nav-config').addEventListener('click', () => document.getElementById('config-btn').click());
            document.getElementById('nav-admin').addEventListener('click', () => document.getElementById('admin-btn').click());
            document.getElementById('nav-voltar').addEventListener('click', voltarParaSelecaoMaquina);
            
            // Event Listeners - Botões globais
            document.getElementById('theme-toggle').addEventListener('click', toggleDarkMode);
            document.getElementById('help-btn').addEventListener('click', abrirAjuda);
            document.getElementById('help-button').addEventListener('click', abrirAjuda);
            document.getElementById('config-btn').addEventListener('click', abrirConfiguracoes);
            document.getElementById('admin-btn').addEventListener('click', abrirLoginAdmin);
            
            // Event Listeners - Exportação/Importação de Dados
            document.getElementById('export-data-btn').addEventListener('click', toggleExportDropdown);
            document.getElementById('export-json').addEventListener('click', exportarDados);
            document.getElementById('import-json').addEventListener('click', () => document.getElementById('import-file').click());
            document.getElementById('import-file').addEventListener('change', importarDados);
            
            // Event Listeners - Ajuda
            document.getElementById('close-help').addEventListener('click', fecharAjuda);
            document.getElementById('close-help-btn').addEventListener('click', fecharAjuda);
            
            // Event Listeners - Configurações
            document.getElementById('dark-mode-toggle').addEventListener('change', (e) => {
                if (e.target.checked) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
            
            document.getElementById('time-unit-toggle').addEventListener('change', (e) => {
                localStorage.setItem(TIME_UNIT_KEY, e.target.checked ? 'horas' : 'minutos');
                atualizarInterfaceConfiguracoes();
            });
            
            document.getElementById('operator-binding-toggle').addEventListener('change', (e) => {
                localStorage.setItem(OPERATOR_BINDING_KEY, e.target.checked.toString());
                atualizarInterfaceConfiguracoes();
            });
            
            document.getElementById('close-config').addEventListener('click', fecharConfiguracoes);
            document.getElementById('close-config-btn').addEventListener('click', fecharConfiguracoes);
            
            document.getElementById('export-all-data').addEventListener('click', exportarDados);
            document.getElementById('import-data').addEventListener('click', () => document.getElementById('import-file').click());
            
            // Event Listeners - Login Admin
            document.getElementById('admin-login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                validarLoginAdmin();
            });
            document.getElementById('close-admin-login').addEventListener('click', fecharLoginAdmin);
            document.getElementById('cancel-admin-login').addEventListener('click', fecharLoginAdmin);
            
            // Event Listeners - Formulário e Tabela
            document.getElementById('parada-form').addEventListener('submit', registrarParada);
            document.getElementById('refresh-registros').addEventListener('click', () => carregarRegistros());
            document.getElementById('limpar-dados').addEventListener('click', confirmarLimparDados);
            document.getElementById('btn-exportar-pdf').addEventListener('click', exportarParaPDF);
            document.getElementById('btn-exportar-excel').addEventListener('click', exportarParaExcel);
            document.getElementById('limpar-filtros').addEventListener('click', limparFiltros);
            
            // Event Listeners - Filtros histórico
            document.getElementById('filtro-data').addEventListener('change', aplicarFiltros);
            document.getElementById('filtro-motivo').addEventListener('change', aplicarFiltros);
            document.getElementById('filtro-operador').addEventListener('change', aplicarFiltros);
            
            // Event Listeners - Paginação
            document.getElementById('prev-page').addEventListener('click', () => mudarPagina(currentPage - 1));
            document.getElementById('next-page').addEventListener('click', () => mudarPagina(currentPage + 1));
            document.getElementById('prev-page-mobile').addEventListener('click', () => mudarPagina(currentPage - 1));
            document.getElementById('next-page-mobile').addEventListener('click', () => mudarPagina(currentPage + 1));
            
            // Event Listeners - Selects do formulário
            document.getElementById('setor').addEventListener('change', filtrarOperadoresPorAtribuicao);
            document.getElementById('motivo').addEventListener('change', filtrarOcorrenciasPorMotivo);
            
            // Event Listeners - Modal Detalhes
            document.getElementById('fechar-detalhes').addEventListener('click', () => document.getElementById('modal-detalhes').classList.add('hidden'));
            document.getElementById('fechar-modal').addEventListener('click', () => document.getElementById('modal-detalhes').classList.add('hidden'));
            
            // Event Listeners - Modal Confirmação
            document.getElementById('confirmar-cancelar').addEventListener('click', fecharModalConfirmacao);
            document.getElementById('confirmar-confirmar').addEventListener('click', executarConfirmacao);
            
            // Event Listeners - Admin Tabs
            document.getElementById('admin-tab-maquinas').addEventListener('click', () => selecionarTabAdmin('maquinas'));
            document.getElementById('admin-tab-motivos').addEventListener('click', () => selecionarTabAdmin('motivos'));
            document.getElementById('admin-tab-ocorrencias').addEventListener('click', () => selecionarTabAdmin('ocorrencias'));
            document.getElementById('admin-tab-setores').addEventListener('click', () => selecionarTabAdmin('setores'));
            document.getElementById('admin-tab-operadores').addEventListener('click', () => selecionarTabAdmin('operadores'));
            document.getElementById('admin-tab-atribuicoes').addEventListener('click', () => selecionarTabAdmin('atribuicoes'));
            document.getElementById('admin-tab-configuracoes').addEventListener('click', () => selecionarTabAdmin('configuracoes'));
            
            // Event Listeners - Formulários Admin
            document.getElementById('form-add-maquina').addEventListener('submit', (e) => {
                e.preventDefault();
                adicionarMaquina();
            });
            
            document.getElementById('form-add-motivo').addEventListener('submit', (e) => {
                e.preventDefault();
                adicionarEditarMotivo();
            });
            
            document.getElementById('form-add-ocorrencia').addEventListener('submit', (e) => {
                e.preventDefault();
                adicionarEditarOcorrencia();
            });
            
            document.getElementById('form-add-setor').addEventListener('submit', (e) => {
                e.preventDefault();
                adicionarEditarSetor();
            });
            
            document.getElementById('form-add-operador').addEventListener('submit', (e) => {
                e.preventDefault();
                adicionarEditarOperador();
            });
            
            document.getElementById('form-add-atribuicao').addEventListener('submit', (e) => {
                e.preventDefault();
                adicionarAtribuicao();
            });
            
            // Event Listeners - Filtros no Admin
            document.getElementById('filtro-ocorrencias-motivo').addEventListener('change', filtrarOcorrenciasAdmin);
            document.getElementById('filtro-atribuicoes').addEventListener('change', filtrarAtribuicoesAdmin);
            
            // Event Listeners - Configurações Admin
            document.getElementById('admin-time-unit-toggle').addEventListener('change', (e) => {
                localStorage.setItem(TIME_UNIT_KEY, e.target.checked ? 'horas' : 'minutos');
                atualizarInterfaceConfiguracoes();
            });
            
            document.getElementById('admin-operator-binding-toggle').addEventListener('change', (e) => {
                localStorage.setItem(OPERATOR_BINDING_KEY, e.target.checked.toString());
                atualizarInterfaceConfiguracoes();
            });
            
            document.getElementById('alterar-senha-admin').addEventListener('click', abrirAlterarSenha);
            document.getElementById('fechar-alterar-senha').addEventListener('click', fecharAlterarSenha);
            document.getElementById('cancelar-alterar-senha').addEventListener('click', fecharAlterarSenha);
            document.getElementById('form-alterar-senha').addEventListener('submit', (e) => {
                e.preventDefault();
                alterarSenhaAdmin();
            });
            
            document.getElementById('admin-export-all').addEventListener('click', exportarDados);
            document.getElementById('admin-import-all').addEventListener('click', () => document.getElementById('admin-import-file').click());
            document.getElementById('admin-import-file').addEventListener('change', importarDados);
            document.getElementById('admin-reset-all').addEventListener('click', confirmarResetarSistema);
            
            document.getElementById('fechar-admin').addEventListener('click', () => document.getElementById('painel-admin').classList.add('hidden'));
            
            // Eventos dos Relatórios
            document.getElementById('relatorio-personalizado-form').addEventListener('submit', (e) => {
                e.preventDefault();
                gerarRelatorioPersonalizado();
            });
            
            document.querySelectorAll('.export-relatorio-diario').forEach(btn => {
                btn.addEventListener('click', exportarRelatorioDiario);
            });
            
            document.querySelectorAll('.export-relatorio-semanal').forEach(btn => {
                btn.addEventListener('click', exportarRelatorioSemanal);
            });
            
            document.querySelectorAll('.export-relatorio-mensal').forEach(btn => {
                btn.addEventListener('click', exportarRelatorioMensal);
            });
            
            // Carrega os selects com dados iniciais
            carregarMotivosSelect();
            carregarSetoresSelect();
            
            // Inicializa gráficos na primeira carga
            const themeMode = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            configurarCoresGraficos(themeMode);
            
            // Event listener para clique fora do dropdown
            document.addEventListener('click', function(e) {
                const exportDropdown = document.getElementById('export-dropdown');
                const exportBtn = document.getElementById('export-data-btn');
                
                if (!exportBtn.contains(e.target) && !exportDropdown.contains(e.target)) {
                    exportDropdown.classList.add('hidden');
                }
            });
            
            // Verifica modo escuro do sistema e atualiza a interface
            function verificarModoEscuro() {
                const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-icon').classList.remove('fa-moon');
                    document.getElementById('theme-icon').classList.add('fa-sun');
                    document.getElementById('dark-mode-toggle').checked = true;
                }
                
                // Configurar cores dos gráficos com base no tema
                const themeMode = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                configurarCoresGraficos(themeMode);
            }
            
            verificarModoEscuro();
            
            // Functions - Utils
            function showLoading(message = 'Carregando...') {
                document.getElementById('loading-text').textContent = message;
                document.getElementById('loading-overlay').classList.remove('hidden');
            }
            
            function hideLoading() {
                document.getElementById('loading-overlay').classList.add('hidden');
            }
            
            function inicializarDadosPadrao() {
                // Verifica se os dados básicos já existem
                if (!localStorage.getItem('maquinas')) {
                    // Máquinas
                    const maquinasDefault = [
                        'Tela 3', 'Tela 4', 'T10', 'T14', 'OMP1', 'OMP2', 'EVG', 'EUROLLS',
                        'LM 1', 'LM 2', 'LM 3', 'LM 4', 'LM 5', 'LM 6', 'Forno', 'Barra 1', 'Barra 6', 'Barra 7'
                    ];
                    localStorage.setItem('maquinas', JSON.stringify(maquinasDefault));
                    
                    // Setores
                    const setoresDefault = ['Manutenção', 'Produção', 'PCP', 'Qualidade', 'Sesmt'];
                    localStorage.setItem('setores', JSON.stringify(setoresDefault));
                    
                    // Operadores
                    const operadoresDefault = [
                        'Diego Ferreira', 'Josué Cardim', 'Adriano', 'Carlos Humberto', 'Jozias',
                        'Fernando Satiro', 'Willian Alves', 'Genilson', 'Everton', 'Leandro Nunes',
                        'Gustavo Gomes', 'José Mendes', 'Robson Paula', 'Caique Lopes', 'Gabriel Ferreira'
                    ];
                    localStorage.setItem('operadores', JSON.stringify(operadoresDefault));
                    
                    // Motivos
                    const motivosDefault = [
                        { codigo: 10, descricao: 'Ajustes' },
                        { codigo: 20, descricao: 'Enroscos' },
                        { codigo: 30, descricao: 'Falhas' },
                        { codigo: 40, descricao: 'Quebras' },
                        { codigo: 50, descricao: 'Travamento' },
                        { codigo: 60, descricao: 'Troca' },
                        { codigo: 70, descricao: 'Outros' }
                    ];
                    localStorage.setItem('motivos', JSON.stringify(motivosDefault));
                    
                    // Ocorrências
                    const ocorrenciasDefault = [
                        { motivo: '10', codigo: 101, descricao: 'Ajuste de pressão' },
                        { motivo: '10', codigo: 102, descricao: 'Ajuste de temperatura' },
                        { motivo: '20', codigo: 201, descricao: 'Enrosco na entrada' },
                        { motivo: '20', codigo: 202, descricao: 'Enrosco na saída' },
                        { motivo: '30', codigo: 301, descricao: 'Falha elétrica' },
                        { motivo: '30', codigo: 302, descricao: 'Falha mecânica' },
                        { motivo: '40', codigo: 401, descricao: 'Quebra de ferramenta' },
                        { motivo: '40', codigo: 402, descricao: 'Quebra de componente' },
                        { motivo: '50', codigo: 501, descricao: 'Travamento hidráulico' },
                        { motivo: '50', codigo: 502, descricao: 'Travamento mecânico' },
                        { motivo: '60', codigo: 601, descricao: 'Troca de ferramenta' },
                        { motivo: '60', codigo: 602, descricao: 'Troca de formato' },
                        { motivo: '70', codigo: 701, descricao: 'Falta de operador' },
                        { motivo: '70', codigo: 702, descricao: 'Falta de material' }
                    ];
                    localStorage.setItem('ocorrencias', JSON.stringify(ocorrenciasDefault));
                    
                    // Atribuições (vinculando operadores a setores ou máquinas)
                    const atribuicoesDefault = [
                        { origem: 'Manutenção', operador: 'Adriano' },
                        { origem: 'Manutenção', operador: 'Carlos Humberto' },
                        { origem: 'Produção', operador: 'Diego Ferreira' },
                        { origem: 'Produção', operador: 'Josué Cardim' },
                        { origem: 'Produção', operador: 'Fernando Satiro' },
                        { origem: 'Produção', operador: 'Jozias' },
                        { origem: 'PCP', operador: 'Everton' },
                        { origem: 'PCP', operador: 'Leandro Nunes' },
                        { origem: 'Qualidade', operador: 'Gustavo Gomes' },
                        { origem: 'Sesmt', operador: 'Gabriel Ferreira' }
                    ];
                    localStorage.setItem('atribuicoes', JSON.stringify(atribuicoesDefault));
                }
            }
            
            function atualizarInterfaceConfiguracoes() {
                const useHoras = localStorage.getItem(TIME_UNIT_KEY) === 'horas';
                const useBindingMaquinas = localStorage.getItem(OPERATOR_BINDING_KEY) === 'true';
                
                // Atualizar toggles
                document.getElementById('time-unit-toggle').checked = useHoras;
                document.getElementById('operator-binding-toggle').checked = useBindingMaquinas;
                document.getElementById('admin-time-unit-toggle').checked = useHoras;
                document.getElementById('admin-operator-binding-toggle').checked = useBindingMaquinas;
                
                // Atualizar labels de unidade de tempo
                document.getElementById('unidade-tempo').textContent = useHoras ? 'horas' : 'minutos';
                
                // Atualizar labels de vinculação
                const vinculacao = useBindingMaquinas ? 'Máquina' : 'Setor';
                document.getElementById('label-atribuicao-maquina-setor').textContent = vinculacao;
                document.getElementById('label-filtro-atribuicoes').textContent = `Filtrar por ${vinculacao}`;
                document.getElementById('th-atribuicao-maquina-setor').textContent = vinculacao;
                
                // Exibir/ocultar elementos do formulário conforme necessário
                if (useBindingMaquinas) {
                    document.getElementById('setor-container').classList.add('hidden');
                } else {
                    document.getElementById('setor-container').classList.remove('hidden');
                }
            }
            
            function toggleDarkMode() {
                document.documentElement.classList.toggle('dark');
                
                const isDark = document.documentElement.classList.contains('dark');
                const icon = document.getElementById('theme-icon');
                
                if (isDark) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
                
                // Atualizar cores dos gráficos
                const themeMode = isDark ? 'dark' : 'light';
                configurarCoresGraficos(themeMode);
                atualizarGraficos();
            }
            
            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('main-content');
                const sidebarTexts = document.querySelectorAll('.sidebar-text');
                
                if (sidebar.classList.contains('sidebar-expanded')) {
                    // Colapsar sidebar
                    sidebar.classList.remove('sidebar-expanded');
                    sidebar.classList.add('sidebar-collapsed');
                    mainContent.classList.remove('ml-64');
                    mainContent.classList.add('ml-20');
                    
                    // Esconder textos
                    sidebarTexts.forEach(el => el.classList.add('hidden'));
                } else {
                    // Expandir sidebar
                    sidebar.classList.remove('sidebar-collapsed');
                    sidebar.classList.add('sidebar-expanded');
                    mainContent.classList.remove('ml-20');
                    mainContent.classList.add('ml-64');
                    
                    // Mostrar textos
                    sidebarTexts.forEach(el => el.classList.remove('hidden'));
                }
            }
            
            function navegarPara(section) {
                // Ocultar todas as seções
                document.getElementById('section-registro').classList.add('hidden');
                document.getElementById('section-historico').classList.add('hidden');
                document.getElementById('section-dashboard').classList.add('hidden');
                document.getElementById('section-relatorios').classList.add('hidden');
                
                // Reset das classes de navegação
                document.getElementById('nav-registro').classList.remove('text-primary', 'dark:text-primary-dark');
                document.getElementById('nav-historico').classList.remove('text-primary', 'dark:text-primary-dark');
                document.getElementById('nav-dashboard').classList.remove('text-primary', 'dark:text-primary-dark');
                document.getElementById('nav-relatorios').classList.remove('text-primary', 'dark:text-primary-dark');
                
                // Mostrar a seção selecionada
                document.getElementById(`section-${section}`).classList.remove('hidden');
                document.getElementById(`nav-${section}`).classList.add('text-primary', 'dark:text-primary-dark');
                
                // Atualizar título da página
                let title = 'Registro de Paradas';
                switch (section) {
                    case 'historico':
                        title = 'Histórico de Paradas';
                        carregarRegistros();
                        break;
                    case 'dashboard':
                        title = 'Dashboard';
                        atualizarDashboard();
                        break;
                    case 'relatorios':
                        title = 'Relatórios';
                        atualizarResumoRelatorios();
                        break;
                }
                document.getElementById('page-title').textContent = title;
            }
            
            // Functions - Ajuda e Configurações
            function abrirAjuda() {
                document.getElementById('help-modal').classList.remove('hidden');
            }
            
            function fecharAjuda() {
                document.getElementById('help-modal').classList.add('hidden');
            }
            
            function abrirConfiguracoes() {
                document.getElementById('config-modal').classList.remove('hidden');
            }
            
            function fecharConfiguracoes() {
                document.getElementById('config-modal').classList.add('hidden');
            }
            
            function abrirLoginAdmin() {
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-error').classList.add('hidden');
                document.getElementById('admin-login-modal').classList.remove('hidden');
                document.getElementById('admin-password').focus();
            }
            
            function fecharLoginAdmin() {
                document.getElementById('admin-login-modal').classList.add('hidden');
            }
            
            function validarLoginAdmin() {
                const senha = document.getElementById('admin-password').value;
                const senhaCorreta = localStorage.getItem(ADMIN_PASSWORD_KEY);
                
                if (senha === senhaCorreta) {
                    fecharLoginAdmin();
                    abrirPainelAdmin();
                } else {
                    document.getElementById('admin-error').classList.remove('hidden');
                    document.getElementById('admin-password').focus();
                }
            }
            
            function abrirPainelAdmin() {
                // Carrega os dados iniciais para o painel admin
                carregarListaMaquinas();
                carregarListaMotivos();
                carregarListaOcorrencias();
                carregarListaSetores();
                carregarListaOperadores();
                carregarListaAtribuicoes();
                
                // Mostra o painel
                document.getElementById('painel-admin').classList.remove('hidden');
            }
            
            function selecionarTabAdmin(tab) {
                // Esconder todas as seções
                document.querySelectorAll('[id^="admin-secao-"]').forEach(el => el.classList.add('hidden'));
                
                // Reset das classes dos tabs
                document.querySelectorAll('[id^="admin-tab-"]').forEach(el => {
                    el.classList.remove('bg-primary', 'text-white');
                    el.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-700');
                });
                
                // Ativar tab selecionado
                document.getElementById(`admin-secao-${tab}`).classList.remove('hidden');
                document.getElementById(`admin-tab-${tab}`).classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-700');
                document.getElementById(`admin-tab-${tab}`).classList.add('bg-primary', 'text-white');
            }
            
            function abrirAlterarSenha() {
                document.getElementById('senha-atual').value = '';
                document.getElementById('nova-senha').value = '';
                document.getElementById('confirmar-senha').value = '';
                document.getElementById('senha-erro').classList.add('hidden');
                document.getElementById('modal-alterar-senha').classList.remove('hidden');
                document.getElementById('senha-atual').focus();
            }
            
            function fecharAlterarSenha() {
                document.getElementById('modal-alterar-senha').classList.add('hidden');
            }
            
            function alterarSenhaAdmin() {
                const senhaAtual = document.getElementById('senha-atual').value;
                const novaSenha = document.getElementById('nova-senha').value;
                const confirmarSenha = document.getElementById('confirmar-senha').value;
                
                const senhaCorreta = localStorage.getItem(ADMIN_PASSWORD_KEY);
                
                if (senhaAtual !== senhaCorreta || novaSenha !== confirmarSenha) {
                    document.getElementById('senha-erro').classList.remove('hidden');
                    return;
                }
                
                // Salvar nova senha
                localStorage.setItem(ADMIN_PASSWORD_KEY, novaSenha);
                fecharAlterarSenha();
                
                // Mostrar confirmação
                mostrarConfirmacao('success', 'Senha alterada com sucesso!');
            }
            
            // Functions - Máquinas
            function carregarSelecaoMaquinas() {
                const containerMaquinas = document.getElementById('machines-grid');
                containerMaquinas.innerHTML = '';
                
                const maquinas = JSON.parse(localStorage.getItem('maquinas') || '[]');
                
                maquinas.forEach(maquina => {
                    const cardMaquina = document.createElement('div');
                    cardMaquina.className = 'bg-white dark:bg-gray-700 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all cursor-pointer premium-card flex flex-col items-center text-center';
                    cardMaquina.innerHTML = `
                        <div class="text-4xl mb-4 text-primary dark:text-primary-dark">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h3 class="text-lg font-semibold">${maquina}</h3>
                    `;
                    
                    cardMaquina.addEventListener('click', () => {
                        selecionarMaquina(maquina);
                    });
                    
                    containerMaquinas.appendChild(cardMaquina);
                });
            }
            
            function selecionarMaquina(maquina) {
                maquinaAtiva = maquina;
                document.getElementById('maquina-selecionada').textContent = maquina;
                
                // Ocultar tela de seleção e mostrar app principal
                document.getElementById('selecao-maquina').classList.add('hidden');
                document.getElementById('app-principal').classList.remove('hidden');
                
                // Reset da navegação
                navegarPara('registro');
                
                // Carregar dados específicos para esta máquina
                carregarSetoresSelect();
                carregarMotivosSelect();
                carregarRegistros();
            }
            
            function voltarParaSelecaoMaquina() {
                // Ocultar app principal e mostrar tela de seleção
                document.getElementById('app-principal').classList.add('hidden');
                document.getElementById('selecao-maquina').classList.remove('hidden');
                
                // Limpar máquina ativa
                maquinaAtiva = '';
            }
            
            function carregarListaMaquinas() {
                const listaMaquinas = document.getElementById('lista-maquinas');
                listaMaquinas.innerHTML = '';
                
                const maquinas = JSON.parse(localStorage.getItem('maquinas') || '[]');
                
                if (maquinas.length === 0) {
                    document.getElementById('sem-maquinas').classList.remove('hidden');
                    return;
                }
                
                document.getElementById('sem-maquinas').classList.add('hidden');
                
                maquinas.forEach(maquina => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3">${maquina}</td>
                        <td class="px-4 py-3 text-right space-x-2">
                            <button class="text-blue-500 hover:text-blue-700 btn-editar-maquina" data-maquina="${maquina}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 btn-excluir-maquina" data-maquina="${maquina}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    listaMaquinas.appendChild(row);
                    
                    // Adicionar event listeners aos botões
                    row.querySelector('.btn-editar-maquina').addEventListener('click', () => {
                        document.getElementById('nova-maquina').value = maquina;
                        document.getElementById('nova-maquina').dataset.oldValue = maquina;
                        document.querySelector('#form-add-maquina button[type="submit"]').innerHTML = '<i class="fas fa-save mr-2"></i>Atualizar';
                    });
                    
                    row.querySelector('.btn-excluir-maquina').addEventListener('click', () => {
                        confirmarAcao('Excluir Máquina', `Tem certeza que deseja excluir a máquina "${maquina}"? Isso também removerá todos os registros de parada associados a ela.`, () => excluirMaquina(maquina));
                    });
                });
                
                // Atualizar selects de atribuição
                atualizarSelectsMaquinas();
            }
            
            function adicionarMaquina() {
                const input = document.getElementById('nova-maquina');
                const nome = input.value.trim();
                
                if (!nome) {
                    mostrarConfirmacao('error', 'Por favor, digite o nome/código da máquina');
                    return;
                }
                
                // Verificar se está em modo de edição
                const oldValue = input.dataset.oldValue;
                
                if (oldValue) {
                    // Modo edição
                    let maquinas = JSON.parse(localStorage.getItem('maquinas') || '[]');
                    
                    // Verificar duplicatas (exceto com o próprio valor anterior)
                    if (nome !== oldValue && maquinas.includes(nome)) {
                        mostrarConfirmacao('error', 'Esta máquina já está cadastrada');
                        return;
                    }
                    
                    // Atualizar nome da máquina
                    maquinas = maquinas.map(m => m === oldValue ? nome : m);
                    
                    // Atualizar também todos os registros e atribuições que usam esta máquina
                    if (nome !== oldValue) {
                        // Atualizar registros
                        let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                        registros = registros.map(r => {
                            if (r.maquina === oldValue) {
                                r.maquina = nome;
                            }
                            return r;
                        });
                        localStorage.setItem('registros', JSON.stringify(registros));
                        
                        // Atualizar atribuições se estamos usando máquinas
                        if (localStorage.getItem(OPERATOR_BINDING_KEY) === 'true') {
                            let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                            atribuicoes = atribuicoes.map(a => {
                                if (a.origem === oldValue) {
                                    a.origem = nome;
                                }
                                return a;
                            });
                            localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                        }
                    }
                    
                    localStorage.setItem('maquinas', JSON.stringify(maquinas));
                    
                    // Resetar formulário para modo adição
                    input.value = '';
                    delete input.dataset.oldValue;
                    document.querySelector('#form-add-maquina button[type="submit"]').innerHTML = '<i class="fas fa-plus mr-2"></i>Adicionar';
                    
                    // Atualizar a interface
                    carregarListaMaquinas();
                    carregarSelecaoMaquinas();
                    
                    mostrarConfirmacao('success', 'Máquina atualizada com sucesso!');
                } else {
                    // Modo adição
                    const maquinas = JSON.parse(localStorage.getItem('maquinas') || '[]');
                    
                    // Verificar duplicatas
                    if (maquinas.includes(nome)) {
                        mostrarConfirmacao('error', 'Esta máquina já está cadastrada');
                        return;
                    }
                    
                    // Adicionar máquina
                    maquinas.push(nome);
                    localStorage.setItem('maquinas', JSON.stringify(maquinas));
                    
                    // Atualizar a interface
                    carregarListaMaquinas();
                    carregarSelecaoMaquinas();
                    
                    // Limpar campo
                    input.value = '';
                    
                    mostrarConfirmacao('success', 'Máquina adicionada com sucesso!');
                }
            }
            
            function excluirMaquina(maquina) {
                let maquinas = JSON.parse(localStorage.getItem('maquinas') || '[]');
                maquinas = maquinas.filter(m => m !== maquina);
                localStorage.setItem('maquinas', JSON.stringify(maquinas));
                
                // Remover registros associados
                let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                registros = registros.filter(r => r.maquina !== maquina);
                localStorage.setItem('registros', JSON.stringify(registros));
                
                // Remover atribuições associadas se estamos usando máquinas
                if (localStorage.getItem(OPERATOR_BINDING_KEY) === 'true') {
                    let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                    atribuicoes = atribuicoes.filter(a => a.origem !== maquina);
                    localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                }
                
                // Atualizar a interface
                carregarListaMaquinas();
                carregarSelecaoMaquinas();
                
                // Se a máquina excluída for a ativa, voltar para a seleção
                if (maquinaAtiva === maquina) {
                    voltarParaSelecaoMaquina();
                }
                
                mostrarConfirmacao('success', 'Máquina excluída com sucesso!');
            }
            
            // Functions - Motivos
            function carregarMotivosSelect() {
                const selectMotivo = document.getElementById('motivo');
                const filtroMotivo = document.getElementById('filtro-motivo');
                const relatorioMotivo = document.getElementById('relatorio-motivo');
                
                // Limpar selects
                selectMotivo.innerHTML = '<option value="">Selecione um motivo</option>';
                filtroMotivo.innerHTML = '<option value="">Todos os motivos</option>';
                relatorioMotivo.innerHTML = '<option value="">Todos os motivos</option>';
                
                // Carregar motivos
                const motivos = JSON.parse(localStorage.getItem('motivos') || '[]');
                motivosCache = motivos;
                
                motivos.forEach(motivo => {
                    const option = document.createElement('option');
                    option.value = motivo.codigo;
                    option.textContent = `${motivo.codigo} - ${motivo.descricao}`;
                    
                    // Adicionar aos selects
                    selectMotivo.appendChild(option.cloneNode(true));
                    filtroMotivo.appendChild(option.cloneNode(true));
                    relatorioMotivo.appendChild(option.cloneNode(true));
                });
                
                // Também atualizar selects no admin
                atualizarSelectsMotivos();
            }
            
            function atualizarSelectsMotivos() {
                const selectMotivoAdmin = document.getElementById('ocorrencia-motivo');
                const filtroMotivoAdmin = document.getElementById('filtro-ocorrencias-motivo');
                
                selectMotivoAdmin.innerHTML = '<option value="">Selecione o motivo</option>';
                filtroMotivoAdmin.innerHTML = '<option value="">Todos os motivos</option>';
                
                const motivos = JSON.parse(localStorage.getItem('motivos') || '[]');
                
                motivos.forEach(motivo => {
                    const option = document.createElement('option');
                    option.value = motivo.codigo;
                    option.textContent = `${motivo.codigo} - ${motivo.descricao}`;
                    
                    selectMotivoAdmin.appendChild(option.cloneNode(true));
                    filtroMotivoAdmin.appendChild(option.cloneNode(true));
                });
            }
            
            function carregarListaMotivos() {
                const listaMotivos = document.getElementById('lista-motivos');
                listaMotivos.innerHTML = '';
                
                const motivos = JSON.parse(localStorage.getItem('motivos') || '[]');
                
                if (motivos.length === 0) {
                    document.getElementById('sem-motivos').classList.remove('hidden');
                    return;
                }
                
                document.getElementById('sem-motivos').classList.add('hidden');
                
                // Ordenar por código
                motivos.sort((a, b) => a.codigo - b.codigo).forEach(motivo => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3">${motivo.codigo}</td>
                        <td class="px-4 py-3">${motivo.descricao}</td>
                        <td class="px-4 py-3 text-right space-x-2">
                            <button class="text-blue-500 hover:text-blue-700 btn-editar-motivo" data-id="${motivo.codigo}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 btn-excluir-motivo" data-id="${motivo.codigo}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    listaMotivos.appendChild(row);
                    
                    // Adicionar event listeners aos botões
                    row.querySelector('.btn-editar-motivo').addEventListener('click', () => {
                        document.getElementById('motivo-codigo').value = motivo.codigo;
                        document.getElementById('motivo-descricao').value = motivo.descricao;
                        document.getElementById('motivo-id').value = motivo.codigo;
                        document.getElementById('btn-motivo-text').textContent = 'Atualizar';
                    });
                    
                    row.querySelector('.btn-excluir-motivo').addEventListener('click', () => {
                        confirmarAcao('Excluir Motivo', `Tem certeza que deseja excluir o motivo "${motivo.codigo} - ${motivo.descricao}"? Isso também removerá todas as ocorrências associadas a este motivo.`, () => excluirMotivo(motivo.codigo));
                    });
                });
            }
            
            function adicionarEditarMotivo() {
                const codigo = parseInt(document.getElementById('motivo-codigo').value);
                const descricao = document.getElementById('motivo-descricao').value.trim();
                const id = document.getElementById('motivo-id').value;
                
                if (!codigo || !descricao) {
                    mostrarConfirmacao('error', 'Por favor, preencha todos os campos');
                    return;
                }
                
                let motivos = JSON.parse(localStorage.getItem('motivos') || '[]');
                
                if (id) {
                    // Modo edição
                    const oldCodigo = parseInt(id);
                    
                    // Verificar se já existe outro motivo com este código (exceto o próprio)
                    if (codigo !== oldCodigo && motivos.some(m => m.codigo === codigo)) {
                        mostrarConfirmacao('error', 'Já existe um motivo com este código');
                        return;
                    }
                    
                    // Atualizar motivo
                    motivos = motivos.map(m => {
                        if (m.codigo === oldCodigo) {
                            return { codigo, descricao };
                        }
                        return m;
                    });
                    
                    // Se o código foi alterado, também precisamos atualizar ocorrências
                    if (codigo !== oldCodigo) {
                        let ocorrencias = JSON.parse(localStorage.getItem('ocorrencias') || '[]');
                        ocorrencias = ocorrencias.map(o => {
                            if (parseInt(o.motivo) === oldCodigo) {
                                o.motivo = codigo.toString();
                            }
                            return o;
                        });
                        localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
                        
                        // Também atualizar registros
                        let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                        registros = registros.map(r => {
                            // Atualizar código do motivo no campo 'codigo' (formato: "motivo-ocorrencia")
                            if (r.codigo && r.codigo.startsWith(oldCodigo + '-')) {
                                r.codigo = r.codigo.replace(oldCodigo + '-', codigo + '-');
                            }
                            
                            // Atualizar descrição do motivo
                            if (r.motivo && r.motivo.startsWith(oldCodigo + ' - ')) {
                                r.motivo = `${codigo} - ${descricao}`;
                            }
                            
                            return r;
                        });
                        localStorage.setItem('registros', JSON.stringify(registros));
                    } else {
                        // Só atualizamos a descrição nos registros
                        let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                        registros = registros.map(r => {
                            if (r.motivo && r.motivo.startsWith(codigo + ' - ')) {
                                r.motivo = `${codigo} - ${descricao}`;
                            }
                            return r;
                        });
                        localStorage.setItem('registros', JSON.stringify(registros));
                    }
                } else {
                    // Modo adição
                    if (motivos.some(m => m.codigo === codigo)) {
                        mostrarConfirmacao('error', 'Já existe um motivo com este código');
                        return;
                    }
                    
                    motivos.push({ codigo, descricao });
                }
                
                localStorage.setItem('motivos', JSON.stringify(motivos));
                
                // Resetar formulário
                document.getElementById('motivo-codigo').value = '';
                document.getElementById('motivo-descricao').value = '';
                document.getElementById('motivo-id').value = '';
                document.getElementById('btn-motivo-text').textContent = 'Adicionar';
                
                // Atualizar interface
                carregarListaMotivos();
                carregarMotivosSelect();
                
                mostrarConfirmacao('success', id ? 'Motivo atualizado com sucesso!' : 'Motivo adicionado com sucesso!');
            }
            
            function excluirMotivo(codigo) {
                let motivos = JSON.parse(localStorage.getItem('motivos') || '[]');
                motivos = motivos.filter(m => m.codigo !== parseInt(codigo));
                localStorage.setItem('motivos', JSON.stringify(motivos));
                
                // Excluir ocorrências relacionadas
                let ocorrencias = JSON.parse(localStorage.getItem('ocorrencias') || '[]');
                ocorrencias = ocorrencias.filter(o => parseInt(o.motivo) !== parseInt(codigo));
                localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
                
                // Atualizar interface
                carregarListaMotivos();
                carregarListaOcorrencias();
                carregarMotivosSelect();
                
                mostrarConfirmacao('success', 'Motivo excluído com sucesso!');
            }
            
            // Functions - Ocorrências
            function filtrarOcorrenciasPorMotivo() {
                const motivoSelecionado = document.getElementById('motivo').value;
                const selectOcorrencia = document.getElementById('ocorrencia');
                
                // Limpar select
                selectOcorrencia.innerHTML = '<option value="">Selecione uma ocorrência</option>';
                
                if (!motivoSelecionado) return;
                
                // Obter ocorrências filtradas
                const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias') || '[]');
                const ocorrenciasFiltradas = ocorrencias.filter(o => parseInt(o.motivo) === parseInt(motivoSelecionado));
                
                // Ordenar por código
                ocorrenciasFiltradas.sort((a, b) => a.codigo - b.codigo).forEach(ocorrencia => {
                    const option = document.createElement('option');
                    option.value = `${ocorrencia.codigo} - ${ocorrencia.descricao}`;
                    option.textContent = `${ocorrencia.codigo} - ${ocorrencia.descricao}`;
                    selectOcorrencia.appendChild(option);
                });
            }
            
            function carregarListaOcorrencias() {
                const listaOcorrencias = document.getElementById('lista-ocorrencias');
                listaOcorrencias.innerHTML = '';
                
                // Obter filtro selecionado
                const filtroMotivo = document.getElementById('filtro-ocorrencias-motivo').value;
                
                let ocorrencias = JSON.parse(localStorage.getItem('ocorrencias') || '[]');
                ocorrenciasCache = ocorrencias;
                
                // Aplicar filtro se houver
                if (filtroMotivo) {
                    ocorrencias = ocorrencias.filter(o => parseInt(o.motivo) === parseInt(filtroMotivo));
                }
                
                if (ocorrencias.length === 0) {
                    document.getElementById('sem-ocorrencias').classList.remove('hidden');
                    return;
                }
                
                document.getElementById('sem-ocorrencias').classList.add('hidden');
                
                // Obter motivos para exibir descrições
                const motivos = JSON.parse(localStorage.getItem('motivos') || '[]');
                const motivosMap = {};
                motivos.forEach(m => {
                    motivosMap[m.codigo] = m.descricao;
                });
                
                // Ordenar por motivo e depois por código
                ocorrencias.sort((a, b) => {
                    if (parseInt(a.motivo) === parseInt(b.motivo)) {
                        return a.codigo - b.codigo;
                    }
                    return parseInt(a.motivo) - parseInt(b.motivo);
                }).forEach(ocorrencia => {
                    const motivoDesc = motivosMap[parseInt(ocorrencia.motivo)] || 'Desconhecido';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3">${ocorrencia.codigo}</td>
                        <td class="px-4 py-3">${ocorrencia.motivo} - ${motivoDesc}</td>
                        <td class="px-4 py-3">${ocorrencia.descricao}</td>
                        <td class="px-4 py-3 text-right space-x-2">
                            <button class="text-blue-500 hover:text-blue-700 btn-editar-ocorrencia" 
                                    data-motivo="${ocorrencia.motivo}" 
                                    data-codigo="${ocorrencia.codigo}" 
                                    data-descricao="${ocorrencia.descricao}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 btn-excluir-ocorrencia" 
                                    data-motivo="${ocorrencia.motivo}" 
                                    data-codigo="${ocorrencia.codigo}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    listaOcorrencias.appendChild(row);
                    
                    // Adicionar event listeners aos botões
                    row.querySelector('.btn-editar-ocorrencia').addEventListener('click', (e) => {
                        const motivo = e.currentTarget.dataset.motivo;
                        const codigo = e.currentTarget.dataset.codigo;
                        const descricao = e.currentTarget.dataset.descricao;
                        
                        document.getElementById('ocorrencia-motivo').value = motivo;
                        document.getElementById('ocorrencia-codigo').value = codigo;
                        document.getElementById('ocorrencia-descricao').value = descricao;
                        document.getElementById('ocorrencia-id').value = JSON.stringify({ motivo, codigo });
                        document.getElementById('btn-ocorrencia-text').textContent = 'Atualizar';
                    });
                    
                    row.querySelector('.btn-excluir-ocorrencia').addEventListener('click', (e) => {
                        const motivo = e.currentTarget.dataset.motivo;
                        const codigo = e.currentTarget.dataset.codigo;
                        confirmarAcao('Excluir Ocorrência', `Tem certeza que deseja excluir a ocorrência de código ${codigo}?`, () => excluirOcorrencia(motivo, codigo));
                    });
                });
            }
            
            function filtrarOcorrenciasAdmin() {
                carregarListaOcorrencias();
            }
            
            function adicionarEditarOcorrencia() {
                const motivo = document.getElementById('ocorrencia-motivo').value;
                const codigo = parseInt(document.getElementById('ocorrencia-codigo').value);
                const descricao = document.getElementById('ocorrencia-descricao').value.trim();
                const idJson = document.getElementById('ocorrencia-id').value;
                
                if (!motivo || !codigo || !descricao) {
                    mostrarConfirmacao('error', 'Por favor, preencha todos os campos');
                    return;
                }
                
                let ocorrencias = JSON.parse(localStorage.getItem('ocorrencias') || '[]');
                
                if (idJson) {
                    // Modo edição
                    const id = JSON.parse(idJson);
                    const oldMotivo = id.motivo;
                    const oldCodigo = parseInt(id.codigo);
                    
                    // Verificar se já existe outra ocorrência com este código para este motivo (exceto a própria)
                    if ((motivo !== oldMotivo || codigo !== oldCodigo) && 
                        ocorrencias.some(o => o.motivo === motivo && o.codigo === codigo)) {
                        mostrarConfirmacao('error', 'Já existe uma ocorrência com este código para este motivo');
                        return;
                    }
                    
                    // Atualizar ocorrência
                    ocorrencias = ocorrencias.map(o => {
                        if (o.motivo === oldMotivo && o.codigo === oldCodigo) {
                            return { motivo, codigo, descricao };
                        }
                        return o;
                    });
                    
                    // Se o código ou motivo foi alterado, também precisamos atualizar registros
                    if (motivo !== oldMotivo || codigo !== oldCodigo) {
                        let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                        registros = registros.map(r => {
                            // Atualizar código no formato "motivo-ocorrencia"
                            if (r.codigo === `${oldMotivo}-${oldCodigo}`) {
                                r.codigo = `${motivo}-${codigo}`;
                                
                                // Também atualizamos a descrição da ocorrência
                                r.ocorrencia = `${codigo} - ${descricao}`;
                            }
                            return r;
                        });
                        localStorage.setItem('registros', JSON.stringify(registros));
                    } else {
                        // Só atualizamos a descrição nos registros
                        let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                        registros = registros.map(r => {
                            if (r.ocorrencia && r.ocorrencia.startsWith(`${codigo} - `)) {
                                r.ocorrencia = `${codigo} - ${descricao}`;
                            }
                            return r;
                        });
                        localStorage.setItem('registros', JSON.stringify(registros));
                    }
                } else {
                    // Modo adição
                    if (ocorrencias.some(o => o.motivo === motivo && o.codigo === codigo)) {
                        mostrarConfirmacao('error', 'Já existe uma ocorrência com este código para este motivo');
                        return;
                    }
                    
                    ocorrencias.push({ motivo, codigo, descricao });
                }
                
                localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
                
                // Resetar formulário
                document.getElementById('ocorrencia-motivo').value = '';
                document.getElementById('ocorrencia-codigo').value = '';
                document.getElementById('ocorrencia-descricao').value = '';
                document.getElementById('ocorrencia-id').value = '';
                document.getElementById('btn-ocorrencia-text').textContent = 'Adicionar';
                
                // Atualizar interface
                carregarListaOcorrencias();
                
                mostrarConfirmacao('success', idJson ? 'Ocorrência atualizada com sucesso!' : 'Ocorrência adicionada com sucesso!');
            }
            
            function excluirOcorrencia(motivo, codigo) {
                let ocorrencias = JSON.parse(localStorage.getItem('ocorrencias') || '[]');
                ocorrencias = ocorrencias.filter(o => !(o.motivo === motivo && o.codigo === parseInt(codigo)));
                localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
                
                // Atualizar interface
                carregarListaOcorrencias();
                
                mostrarConfirmacao('success', 'Ocorrência excluída com sucesso!');
            }
            
            // Functions - Setores
            function carregarSetoresSelect() {
                const selectSetor = document.getElementById('setor');
                selectSetor.innerHTML = '<option value="">Selecione o setor</option>';
                
                // Se estamos usando máquinas em vez de setores, ocultamos o campo
                const useBindingMaquinas = localStorage.getItem(OPERATOR_BINDING_KEY) === 'true';
                if (useBindingMaquinas) {
                    document.getElementById('setor-container').classList.add('hidden');
                    return;
                } else {
                    document.getElementById('setor-container').classList.remove('hidden');
                }
                
                const setores = JSON.parse(localStorage.getItem('setores') || '[]');
                
                setores.forEach(setor => {
                    const option = document.createElement('option');
                    option.value = setor;
                    option.textContent = setor;
                    selectSetor.appendChild(option);
                });
            }
            
            function carregarListaSetores() {
                const listaSetores = document.getElementById('lista-setores');
                listaSetores.innerHTML = '';
                
                const setores = JSON.parse(localStorage.getItem('setores') || '[]');
                
                if (setores.length === 0) {
                    document.getElementById('sem-setores').classList.remove('hidden');
                    return;
                }
                
                document.getElementById('sem-setores').classList.add('hidden');
                
                setores.sort().forEach(setor => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3">${setor}</td>
                        <td class="px-4 py-3 text-right space-x-2">
                            <button class="text-blue-500 hover:text-blue-700 btn-editar-setor" data-setor="${setor}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 btn-excluir-setor" data-setor="${setor}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    listaSetores.appendChild(row);
                    
                    // Adicionar event listeners aos botões
                    row.querySelector('.btn-editar-setor').addEventListener('click', () => {
                        document.getElementById('setor-nome').value = setor;
                        document.getElementById('setor-id').value = setor;
                        document.getElementById('btn-setor-text').textContent = 'Atualizar';
                    });
                    
                    row.querySelector('.btn-excluir-setor').addEventListener('click', () => {
                        confirmarAcao('Excluir Setor', `Tem certeza que deseja excluir o setor "${setor}"? Isso também removerá todas as atribuições associadas a este setor.`, () => excluirSetor(setor));
                    });
                });
                
                // Atualizar selects de atribuição
                atualizarSelectsAtribuicao();
            }
            
            function adicionarEditarSetor() {
                const nome = document.getElementById('setor-nome').value.trim();
                const id = document.getElementById('setor-id').value;
                
                if (!nome) {
                    mostrarConfirmacao('error', 'Por favor, digite o nome do setor');
                    return;
                }
                
                let setores = JSON.parse(localStorage.getItem('setores') || '[]');
                
                if (id) {
                    // Modo edição
                    // Verificar duplicatas (exceto com o próprio valor anterior)
                    if (nome !== id && setores.includes(nome)) {
                        mostrarConfirmacao('error', 'Este setor já está cadastrado');
                        return;
                    }
                    
                    // Atualizar nome do setor
                    setores = setores.map(s => s === id ? nome : s);
                    
                    // Atualizar também todos os registros e atribuições que usam este setor
                    if (nome !== id) {
                        // Atualizar registros
                        let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                        registros = registros.map(r => {
                            if (r.setor === id) {
                                r.setor = nome;
                            }
                            return r;
                        });
                        localStorage.setItem('registros', JSON.stringify(registros));
                        
                        // Atualizar atribuições se estamos usando setores
                        if (localStorage.getItem(OPERATOR_BINDING_KEY) !== 'true') {
                            let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                            atribuicoes = atribuicoes.map(a => {
                                if (a.origem === id) {
                                    a.origem = nome;
                                }
                                return a;
                            });
                            localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                        }
                    }
                } else {
                    // Modo adição
                    if (setores.includes(nome)) {
                        mostrarConfirmacao('error', 'Este setor já está cadastrado');
                        return;
                    }
                    
                    setores.push(nome);
                }
                
                localStorage.setItem('setores', JSON.stringify(setores));
                
                // Resetar formulário
                document.getElementById('setor-nome').value = '';
                document.getElementById('setor-id').value = '';
                document.getElementById('btn-setor-text').textContent = 'Adicionar';
                
                // Atualizar interface
                carregarListaSetores();
                carregarSetoresSelect();
                
                mostrarConfirmacao('success', id ? 'Setor atualizado com sucesso!' : 'Setor adicionado com sucesso!');
            }
            
            function excluirSetor(setor) {
                let setores = JSON.parse(localStorage.getItem('setores') || '[]');
                setores = setores.filter(s => s !== setor);
                localStorage.setItem('setores', JSON.stringify(setores));
                
                // Remover atribuições associadas se estamos usando setores
                if (localStorage.getItem(OPERATOR_BINDING_KEY) !== 'true') {
                    let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                    atribuicoes = atribuicoes.filter(a => a.origem !== setor);
                    localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                }
                
                // Atualizar interface
                carregarListaSetores();
                carregarSetoresSelect();
                
                mostrarConfirmacao('success', 'Setor excluído com sucesso!');
            }
            
            // Functions - Operadores
            function carregarListaOperadores() {
                const listaOperadores = document.getElementById('lista-operadores');
                listaOperadores.innerHTML = '';
                
                const operadores = JSON.parse(localStorage.getItem('operadores') || '[]');
                
                if (operadores.length === 0) {
                    document.getElementById('sem-operadores').classList.remove('hidden');
                    return;
                }
                
                document.getElementById('sem-operadores').classList.add('hidden');
                
                operadores.sort().forEach(operador => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3">${operador}</td>
                        <td class="px-4 py-3 text-right space-x-2">
                            <button class="text-blue-500 hover:text-blue-700 btn-editar-operador" data-operador="${operador}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 btn-excluir-operador" data-operador="${operador}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    listaOperadores.appendChild(row);
                    
                    // Adicionar event listeners aos botões
                    row.querySelector('.btn-editar-operador').addEventListener('click', () => {
                        document.getElementById('operador-nome').value = operador;
                        document.getElementById('operador-id').value = operador;
                        document.getElementById('btn-operador-text').textContent = 'Atualizar';
                    });
                    
                    row.querySelector('.btn-excluir-operador').addEventListener('click', () => {
                        confirmarAcao('Excluir Operador', `Tem certeza que deseja excluir o operador "${operador}"? Isso também removerá todas as atribuições associadas a este operador.`, () => excluirOperador(operador));
                    });
                });
                
                // Atualizar selects de atribuição
                atualizarSelectsAtribuicao();
            }
            
            function adicionarEditarOperador() {
                const nome = document.getElementById('operador-nome').value.trim();
                const id = document.getElementById('operador-id').value;
                
                if (!nome) {
                    mostrarConfirmacao('error', 'Por favor, digite o nome do operador');
                    return;
                }
                
                let operadores = JSON.parse(localStorage.getItem('operadores') || '[]');
                
                if (id) {
                    // Modo edição
                    // Verificar duplicatas (exceto com o próprio valor anterior)
                    if (nome !== id && operadores.includes(nome)) {
                        mostrarConfirmacao('error', 'Este operador já está cadastrado');
                        return;
                    }
                    
                    // Atualizar nome do operador
                    operadores = operadores.map(o => o === id ? nome : o);
                    
                    // Atualizar também todos os registros e atribuições que usam este operador
                    if (nome !== id) {
                        // Atualizar registros
                        let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                        registros = registros.map(r => {
                            if (r.operador === id) {
                                r.operador = nome;
                            }
                            return r;
                        });
                        localStorage.setItem('registros', JSON.stringify(registros));
                        
                        // Atualizar atribuições
                        let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                        atribuicoes = atribuicoes.map(a => {
                            if (a.operador === id) {
                                a.operador = nome;
                            }
                            return a;
                        });
                        localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                    }
                } else {
                    // Modo adição
                    if (operadores.includes(nome)) {
                        mostrarConfirmacao('error', 'Este operador já está cadastrado');
                        return;
                    }
                    
                    operadores.push(nome);
                }
                
                localStorage.setItem('operadores', JSON.stringify(operadores));
                
                // Resetar formulário
                document.getElementById('operador-nome').value = '';
                document.getElementById('operador-id').value = '';
                document.getElementById('btn-operador-text').textContent = 'Adicionar';
                
                // Atualizar interface
                carregarListaOperadores();
                
                mostrarConfirmacao('success', id ? 'Operador atualizado com sucesso!' : 'Operador adicionado com sucesso!');
            }
            
            function excluirOperador(operador) {
                let operadores = JSON.parse(localStorage.getItem('operadores') || '[]');
                operadores = operadores.filter(o => o !== operador);
                localStorage.setItem('operadores', JSON.stringify(operadores));
                
                // Remover atribuições associadas
                let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                atribuicoes = atribuicoes.filter(a => a.operador !== operador);
                localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                
                // Atualizar interface
                carregarListaOperadores();
                
                mostrarConfirmacao('success', 'Operador excluído com sucesso!');
            }
            
            // Functions - Atribuições
            function atualizarSelectsAtribuicao() {
                const useBindingMaquinas = localStorage.getItem(OPERATOR_BINDING_KEY) === 'true';
                const origemLabel = useBindingMaquinas ? 'Máquina' : 'Setor';
                
                // Atualizar labels
                document.getElementById('label-atribuicao-maquina-setor').textContent = origemLabel;
                document.getElementById('label-filtro-atribuicoes').textContent = `Filtrar por ${origemLabel}`;
                document.getElementById('th-atribuicao-maquina-setor').textContent = origemLabel;
                
                // Carregar origens (máquinas ou setores) no select de atribuição
                const selectOrigem = document.getElementById('atribuicao-maquina-setor');
                const filtroAtribuicoes = document.getElementById('filtro-atribuicoes');
                selectOrigem.innerHTML = `<option value="">Selecione ${origemLabel.toLowerCase()}</option>`;
                filtroAtribuicoes.innerHTML = `<option value="">Todos</option>`;
                
                let origens = [];
                if (useBindingMaquinas) {
                    origens = JSON.parse(localStorage.getItem('maquinas') || '[]');
                } else {
                    origens = JSON.parse(localStorage.getItem('setores') || '[]');
                }
                
                origens.forEach(origem => {
                    const option = document.createElement('option');
                    option.value = origem;
                    option.textContent = origem;
                    
                    selectOrigem.appendChild(option.cloneNode(true));
                    filtroAtribuicoes.appendChild(option.cloneNode(true));
                });
                
                // Carregar operadores no select de atribuição
                const selectOperador = document.getElementById('atribuicao-operador');
                selectOperador.innerHTML = '<option value="">Selecione o operador</option>';
                
                const operadores = JSON.parse(localStorage.getItem('operadores') || '[]');
                operadores.sort().forEach(operador => {
                    const option = document.createElement('option');
                    option.value = operador;
                    option.textContent = operador;
                    selectOperador.appendChild(option);
                });
            }
            
            function carregarListaAtribuicoes() {
                const listaAtribuicoes = document.getElementById('lista-atribuicoes');
                listaAtribuicoes.innerHTML = '';
                
                // Obter filtro selecionado
                const filtroOrigem = document.getElementById('filtro-atribuicoes').value;
                
                let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                
                // Aplicar filtro se houver
                if (filtroOrigem) {
                    atribuicoes = atribuicoes.filter(a => a.origem === filtroOrigem);
                }
                
                if (atribuicoes.length === 0) {
                    document.getElementById('sem-atribuicoes').classList.remove('hidden');
                    return;
                }
                
                document.getElementById('sem-atribuicoes').classList.add('hidden');
                
                // Ordenar por origem e depois por operador
                atribuicoes.sort((a, b) => {
                    if (a.origem === b.origem) {
                        return a.operador.localeCompare(b.operador);
                    }
                    return a.origem.localeCompare(b.origem);
                }).forEach(atribuicao => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3">${atribuicao.origem}</td>
                        <td class="px-4 py-3">${atribuicao.operador}</td>
                        <td class="px-4 py-3 text-right">
                            <button class="text-red-500 hover:text-red-700 btn-excluir-atribuicao" 
                                    data-origem="${atribuicao.origem}" 
                                    data-operador="${atribuicao.operador}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    listaAtribuicoes.appendChild(row);
                    
                    // Adicionar event listener para exclusão
                    row.querySelector('.btn-excluir-atribuicao').addEventListener('click', (e) => {
                        const origem = e.currentTarget.dataset.origem;
                        const operador = e.currentTarget.dataset.operador;
                        const origemTipo = localStorage.getItem(OPERATOR_BINDING_KEY) === 'true' ? 'máquina' : 'setor';
                        confirmarAcao('Excluir Atribuição', `Tem certeza que deseja remover o operador "${operador}" da ${origemTipo} "${origem}"?`, () => excluirAtribuicao(origem, operador));
                    });
                });
            }
            
            function filtrarAtribuicoesAdmin() {
                carregarListaAtribuicoes();
            }
            
            function adicionarAtribuicao() {
                const origem = document.getElementById('atribuicao-maquina-setor').value;
                const operador = document.getElementById('atribuicao-operador').value;
                
                if (!origem || !operador) {
                    const origemTipo = localStorage.getItem(OPERATOR_BINDING_KEY) === 'true' ? 'máquina' : 'setor';
                    mostrarConfirmacao('error', `Por favor, selecione ${origemTipo} e operador`);
                    return;
                }
                
                let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                
                // Verificar se já existe
                if (atribuicoes.some(a => a.origem === origem && a.operador === operador)) {
                    mostrarConfirmacao('error', 'Esta atribuição já existe');
                    return;
                }
                
                atribuicoes.push({ origem, operador });
                localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                
                // Resetar selects
                document.getElementById('atribuicao-maquina-setor').value = '';
                document.getElementById('atribuicao-operador').value = '';
                
                // Atualizar interface
                carregarListaAtribuicoes();
                
                mostrarConfirmacao('success', 'Atribuição adicionada com sucesso!');
            }
            
            function excluirAtribuicao(origem, operador) {
                let atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                atribuicoes = atribuicoes.filter(a => !(a.origem === origem && a.operador === operador));
                localStorage.setItem('atribuicoes', JSON.stringify(atribuicoes));
                
                // Atualizar interface
                carregarListaAtribuicoes();
                
                mostrarConfirmacao('success', 'Atribuição removida com sucesso!');
            }
            
            function filtrarOperadoresPorAtribuicao() {
                const useBindingMaquinas = localStorage.getItem(OPERATOR_BINDING_KEY) === 'true';
                const selectOperador = document.getElementById('operador');
                const origemValue = useBindingMaquinas ? maquinaAtiva : document.getElementById('setor').value;
                
                // Limpar select de operadores
                selectOperador.innerHTML = '<option value="">Selecione o operador</option>';
                
                if (!origemValue) return;
                
                // Obter operadores atribuídos à origem selecionada
                const atribuicoes = JSON.parse(localStorage.getItem('atribuicoes') || '[]');
                const operadoresAtribuidos = atribuicoes
                    .filter(a => a.origem === origemValue)
                    .map(a => a.operador);
                
                // Se não houver operadores atribuídos, mostrar todos
                if (operadoresAtribuidos.length === 0) {
                    const operadores = JSON.parse(localStorage.getItem('operadores') || '[]');
                    operadores.sort().forEach(operador => {
                        const option = document.createElement('option');
                        option.value = operador;
                        option.textContent = operador;
                        selectOperador.appendChild(option);
                    });
                    return;
                }
                
                // Mostrar apenas operadores atribuídos
                operadoresAtribuidos.sort().forEach(operador => {
                    const option = document.createElement('option');
                    option.value = operador;
                    option.textContent = operador;
                    selectOperador.appendChild(option);
                });
            }
            
            // Functions - Registros
            function registrarParada(e) {
                e.preventDefault();
                
                // Obter valores do formulário
                const data = document.getElementById('data').value;
                const setor = localStorage.getItem(OPERATOR_BINDING_KEY) === 'true' ? '' : document.getElementById('setor').value;
                const operador = document.getElementById('operador').value;
                const motivo = document.getElementById('motivo').value;
                const motivoTexto = document.getElementById('motivo').options[document.getElementById('motivo').selectedIndex].text;
                const ocorrencia = document.getElementById('ocorrencia').value;
                const ocorrenciaTexto = document.getElementById('ocorrencia').options[document.getElementById('ocorrencia').selectedIndex].text;
                const duracao = document.getElementById('duracao').value;
                const observacoes = document.getElementById('observacoes').value;
                
                // Validações
                if (!data || !operador || !motivo || !ocorrencia || !duracao) {
                    mostrarConfirmacao('error', 'Por favor, preencha todos os campos obrigatórios');
                    return;
                }
                
                if (!localStorage.getItem(OPERATOR_BINDING_KEY) === 'true' && !setor) {
                    mostrarConfirmacao('error', 'Por favor, selecione o setor');
                    return;
                }
                
                // Extrair código da ocorrência (ex: "101 - Ajuste de pressão" -> "101")
                const codigoOcorrencia = ocorrencia.split(' - ')[0];
                
                // Código composto (motivo-ocorrencia)
                const codigoComposto = `${motivo}-${codigoOcorrencia}`;
                
                // Criar objeto com os dados
                const registro = {
                    id: Date.now().toString(), // Usar timestamp como ID único
                    data,
                    maquina: maquinaAtiva,
                    setor,
                    operador,
                    codigo: codigoComposto,
                    motivo: motivoTexto,
                    ocorrencia: ocorrenciaTexto,
                    duracao,
                    observacoes,
                    timestamp: new Date().toISOString()
                };
                
                // Salvar no localStorage
                const registros = JSON.parse(localStorage.getItem('registros') || '[]');
                registros.push(registro);
                localStorage.setItem('registros', JSON.stringify(registros));
                
                // Resetar formulário
                form.reset();
                
                // Reinicializar selects e definir a data atual novamente
                carregarSetoresSelect();
                document.getElementById('operador').innerHTML = '<option value="">Selecione o operador</option>';
                document.getElementById('ocorrencia').innerHTML = '<option value="">Selecione uma ocorrência</option>';
                document.getElementById('data').value = `${anoAtual}-${mesAtual}-${diaAtual}`;
                
                // Mostrar mensagem de sucesso
                mostrarConfirmacao('success', 'Parada registrada com sucesso!');
                
                // Atualizar gráficos se estiver no dashboard
                if (!document.getElementById('section-dashboard').classList.contains('hidden')) {
                    atualizarDashboard();
                }
            }
            
            function carregarRegistros() {
                const tabelaRegistros = document.getElementById('tabela-registros');
                tabelaRegistros.innerHTML = '';
                
                // Carregar operadores no filtro de histórico
                const filtroOperador = document.getElementById('filtro-operador');
                filtroOperador.innerHTML = '<option value="">Todos os operadores</option>';
                
                const operadores = new Set();
                
                let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                
                // Filtrar registros para a máquina atual
                registros = registros.filter(registro => registro.maquina === maquinaAtiva);
                
                // Aplicar outros filtros
                const filtroData = document.getElementById('filtro-data').value;
                const filtroMotivo = document.getElementById('filtro-motivo').value;
                const filtroOperadorValue = document.getElementById('filtro-operador').value;
                
                if (filtroData) {
                    registros = registros.filter(registro => registro.data === filtroData);
                }
                
                if (filtroMotivo) {
                    registros = registros.filter(registro => registro.codigo.startsWith(filtroMotivo + '-'));
                }
                
                if (filtroOperadorValue) {
                    registros = registros.filter(registro => registro.operador === filtroOperadorValue);
                }
                
                // Coletar operadores únicos para o filtro
                registros.forEach(registro => {
                    operadores.add(registro.operador);
                });
                
                // Preencher select de operadores para filtrar
                Array.from(operadores).sort().forEach(operador => {
                    const option = document.createElement('option');
                    option.value = operador;
                    option.textContent = operador;
                    filtroOperador.appendChild(option);
                });
                
                if (registros.length === 0) {
                    document.getElementById('sem-registros').style.display = 'block';
                    atualizarPaginacao(0, 0, 0);
                    return;
                }
                
                document.getElementById('sem-registros').style.display = 'none';
                
                // Ordenar registros por data (mais recentes primeiro)
                registros.sort((a, b) => new Date(b.data) - new Date(a.data));
                
                // Paginação
                const totalRegistros = registros.length;
                const totalPaginas = Math.ceil(totalRegistros / itemsPerPage);
                
                // Ajustar página atual se necessário
                if (currentPage > totalPaginas) {
                    currentPage = totalPaginas;
                }
                
                // Calcular índices de início e fim para a página atual
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, totalRegistros);
                
                // Atualizar paginação
                atualizarPaginacao(startIndex, endIndex, totalRegistros);
                
                // Exibir apenas os registros da página atual
                for (let i = startIndex; i < endIndex; i++) {
                    adicionarRegistroTabela(registros[i]);
                }
            }
            
            function adicionarRegistroTabela(registro) {
                const tabelaRegistros = document.getElementById('tabela-registros');
                
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50', 'dark:hover:bg-gray-700');
                
                // Converter unidade de tempo se necessário
                let duracaoFormatada = registro.duracao;
                const unidadeTempo = localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'h' : 'min';
                
                if (localStorage.getItem(TIME_UNIT_KEY) === 'horas' && !isNaN(registro.duracao)) {
                    // Converter minutos para horas com 2 casas decimais
                    duracaoFormatada = (parseFloat(registro.duracao) / 60).toFixed(2);
                }
                
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${formatarDataSimples(registro.data)}</td>
                    <td class="px-4 py-3">${registro.maquina}</td>
                    <td class="px-4 py-3">${registro.setor || '-'}</td>
                    <td class="px-4 py-3">${registro.operador}</td>
                    <td class="px-4 py-3 font-medium">${registro.codigo}</td>
                    <td class="px-4 py-3">${registro.motivo}</td>
                    <td class="px-4 py-3">${registro.ocorrencia}</td>
                    <td class="px-4 py-3">${duracaoFormatada} ${unidadeTempo}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <button class="text-blue-500 hover:text-blue-700 mr-2 btn-detalhes" data-id="${registro.id}">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-700 btn-excluir" data-id="${registro.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                tabelaRegistros.appendChild(row);
                
                // Adicionar event listeners aos botões
                row.querySelector('.btn-detalhes').addEventListener('click', () => mostrarDetalhesRegistro(registro));
                row.querySelector('.btn-excluir').addEventListener('click', () => confirmarAcao('Excluir Registro', 'Tem certeza que deseja excluir este registro?', () => excluirRegistro(registro.id)));
            }
            
            function mostrarDetalhesRegistro(registro) {
                const unidadeTempo = localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'horas' : 'minutos';
                let duracaoFormatada = registro.duracao;
                
                if (localStorage.getItem(TIME_UNIT_KEY) === 'horas' && !isNaN(registro.duracao)) {
                    duracaoFormatada = (parseFloat(registro.duracao) / 60).toFixed(2);
                }
                
                document.getElementById('modal-conteudo').innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Data</p>
                            <p class="font-medium">${formatarDataSimples(registro.data)}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Máquina</p>
                            <p class="font-medium">${registro.maquina}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Setor</p>
                            <p class="font-medium">${registro.setor || '-'}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Operador</p>
                            <p class="font-medium">${registro.operador}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Código</p>
                            <p class="font-medium">${registro.codigo}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Motivo da Parada</p>
                            <p class="font-medium">${registro.motivo}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Ocorrência</p>
                            <p class="font-medium">${registro.ocorrencia}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Duração</p>
                            <p class="font-medium">${duracaoFormatada} ${unidadeTempo}</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <p class="text-sm text-gray-500 dark:text-gray-400">Observações</p>
                        <p class="font-medium">${registro.observacoes || 'Nenhuma observação registrada'}</p>
                    </div>
                    <div class="mt-4 text-xs text-gray-500 dark:text-gray-400">
                        <p>Registrado em: ${formatarDataCompleta(registro.timestamp)}</p>
                    </div>
                `;
                
                document.getElementById('modal-detalhes').classList.remove('hidden');
            }
            
            function excluirRegistro(id) {
                let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                registros = registros.filter(registro => registro.id !== id);
                localStorage.setItem('registros', JSON.stringify(registros));
                
                // Atualizar tabela
                carregarRegistros();
                
                // Atualizar gráficos se estiver no dashboard
                if (!document.getElementById('section-dashboard').classList.contains('hidden')) {
                    atualizarDashboard();
                }
                
                mostrarConfirmacao('success', 'Registro excluído com sucesso!');
            }
            
            function confirmarLimparDados() {
                confirmarAcao('Limpar Dados', `Tem certeza que deseja excluir TODOS os registros da máquina "${maquinaAtiva}"? Esta ação não pode ser desfeita.`, limparDados);
            }
            
            function limparDados() {
                let registros = JSON.parse(localStorage.getItem('registros') || '[]');
                registros = registros.filter(registro => registro.maquina !== maquinaAtiva);
                localStorage.setItem('registros', JSON.stringify(registros));
                
                // Atualizar tabela
                carregarRegistros();
                
                // Atualizar gráficos se estiver no dashboard
                if (!document.getElementById('section-dashboard').classList.contains('hidden')) {
                    atualizarDashboard();
                }
                
                mostrarConfirmacao('success', 'Todos os registros desta máquina foram excluídos com sucesso!');
            }
            
            function aplicarFiltros() {
                carregarRegistros();
            }
            
            function limparFiltros() {
                document.getElementById('filtro-data').value = '';
                document.getElementById('filtro-motivo').value = '';
                document.getElementById('filtro-operador').value = '';
                
                carregarRegistros();
            }
            
            // Functions - Paginação
            function atualizarPaginacao(startIndex, endIndex, totalRegistros) {
                const totalPaginas = Math.ceil(totalRegistros / itemsPerPage);
                
                // Atualizar texto de contagem
                document.getElementById('page-start').textContent = totalRegistros > 0 ? startIndex + 1 : 0;
                document.getElementById('page-end').textContent = endIndex;
                document.getElementById('total-items').textContent = totalRegistros;
                
                // Atualizar botões de navegação
                document.getElementById('prev-page').disabled = currentPage <= 1;
                document.getElementById('next-page').disabled = currentPage >= totalPaginas;
                document.getElementById('prev-page-mobile').disabled = currentPage <= 1;
                document.getElementById('next-page-mobile').disabled = currentPage >= totalPaginas;
                
                // Atualizar números de página
                const paginationNumbers = document.getElementById('pagination-numbers');
                paginationNumbers.innerHTML = '';
                
                // Determinar quais páginas mostrar
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPaginas, currentPage + 2);
                
                // Ajustar para mostrar sempre 5 páginas quando possível
                if (endPage - startPage < 4 && totalPaginas > 4) {
                    if (currentPage < 3) {
                        endPage = Math.min(5, totalPaginas);
                    } else if (currentPage > totalPaginas - 2) {
                        startPage = Math.max(1, totalPaginas - 4);
                    }
                }
                
                // Adicionar primeira página e ellipsis se necessário
                if (startPage > 1) {
                    adicionarBotaoPagina(1);
                    if (startPage > 2) {
                        adicionarEllipsis();
                    }
                }
                
                // Adicionar páginas numeradas
                for (let i = startPage; i <= endPage; i++) {
                    adicionarBotaoPagina(i);
                }
                
                // Adicionar última página e ellipsis se necessário
                if (endPage < totalPaginas) {
                    if (endPage < totalPaginas - 1) {
                        adicionarEllipsis();
                    }
                    adicionarBotaoPagina(totalPaginas);
                }
            }
            
            function adicionarBotaoPagina(pagina) {
                const paginationNumbers = document.getElementById('pagination-numbers');
                const button = document.createElement('button');
                button.className = `relative inline-flex items-center px-4 py-2 border text-sm font-medium ${
                    pagina === currentPage
                    ? 'bg-primary border-primary text-white'
                    : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'
                }`;
                button.textContent = pagina;
                button.addEventListener('click', () => mudarPagina(pagina));
                paginationNumbers.appendChild(button);
            }
            
            function adicionarEllipsis() {
                const paginationNumbers = document.getElementById('pagination-numbers');
                const span = document.createElement('span');
                span.className = 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300';
                span.textContent = '...';
                paginationNumbers.appendChild(span);
            }
            
            function mudarPagina(pagina) {
                const totalRegistros = parseInt(document.getElementById('total-items').textContent);
                const totalPaginas = Math.ceil(totalRegistros / itemsPerPage);
                
                if (pagina < 1 || pagina > totalPaginas) {
                    return;
                }
                
                currentPage = pagina;
                carregarRegistros();
            }
            
            // Functions - Dashboard
            function atualizarDashboard() {
                // Obter registros para a máquina selecionada
                const registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => registro.maquina === maquinaAtiva);
                
                // Atualizar cards de estatísticas
                atualizarEstatisticas(registros);
                
                // Atualizar gráficos
                atualizarGraficos(registros);
            }
            
            function atualizarEstatisticas(registros) {
                const totalParadas = registros.length;
                document.getElementById('total-paradas').textContent = totalParadas;
                
                // Calcular tempo total parado
                let tempoTotal = 0;
                registros.forEach(registro => {
                    tempoTotal += parseFloat(registro.duracao) || 0;
                });
                
                // Formatar tempo total
                const unidadeTempo = localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'h' : 'min';
                let tempoFormatado = tempoTotal;
                if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                    tempoFormatado = (tempoTotal / 60).toFixed(2);
                }
                document.getElementById('tempo-total-parado').textContent = `${tempoFormatado} ${unidadeTempo}`;
                
                // Calcular percentuais (exemplo simples, pode ser melhorado)
                document.getElementById('percentual-paradas').textContent = '+5%';
                document.getElementById('percentual-tempo').textContent = '+8%';
                
                // Motivo mais frequente
                const contagemMotivos = {};
                registros.forEach(registro => {
                    const motivo = registro.motivo;
                    contagemMotivos[motivo] = (contagemMotivos[motivo] || 0) + 1;
                });
                
                let motivoFrequente = '-';
                let maxCount = 0;
                for (const [motivo, count] of Object.entries(contagemMotivos)) {
                    if (count > maxCount) {
                        maxCount = count;
                        motivoFrequente = motivo;
                    }
                }
                
                // Extrair apenas o código do motivo para exibição
                if (motivoFrequente !== '-') {
                    const codigoMotivo = motivoFrequente.split(' - ')[0];
                    document.getElementById('motivo-frequente').textContent = codigoMotivo;
                    const percentual = ((maxCount / totalParadas) * 100).toFixed(1);
                    document.getElementById('motivo-ocorrencias').textContent = `${maxCount} ocorrências (${percentual}%)`;
                } else {
                    document.getElementById('motivo-frequente').textContent = '-';
                    document.getElementById('motivo-ocorrencias').textContent = '0 ocorrências (0%)';
                }
                
                // Parada mais longa
                let paradaMaisLonga = 0;
                let detalhesParadaLonga = '-';
                registros.forEach(registro => {
                    const duracao = parseFloat(registro.duracao) || 0;
                    if (duracao > paradaMaisLonga) {
                        paradaMaisLonga = duracao;
                        detalhesParadaLonga = `${registro.motivo} em ${formatarDataSimples(registro.data)}`;
                    }
                });
                
                // Formatar parada mais longa
                let paradaLongaFormatada = paradaMaisLonga;
                if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                    paradaLongaFormatada = (paradaMaisLonga / 60).toFixed(2);
                }
                document.getElementById('parada-longa').textContent = `${paradaLongaFormatada} ${unidadeTempo}`;
                document.getElementById('parada-longa-info').textContent = detalhesParadaLonga;
            }
            
            function atualizarGraficos(registros) {
                // Destruir gráficos existentes se houver
                const contextos = ['motivos-chart', 'tempo-diario-chart', 'ocorrencias-chart'];
                contextos.forEach(id => {
                    const canvas = document.getElementById(id);
                    if (canvas._chart) {
                        canvas._chart.destroy();
                    }
                });
                
                // Criar novos gráficos
                criarGraficoMotivos(registros);
                criarGraficoTempoDiario(registros);
                criarGraficoOcorrencias(registros);
            }
            
            function configurarCoresGraficos(theme) {
                const isDark = theme === 'dark';
                
                Chart.defaults.color = isDark ? '#e5e7eb' : '#374151';
                Chart.defaults.borderColor = isDark ? '#374151' : '#e5e7eb';
                Chart.defaults.backgroundColor = isDark ? '#1f2937' : '#ffffff';
            }
            
            function gerarCores(quantidade, alpha = 0.7) {
                const colors = [
                    `rgba(59, 130, 246, ${alpha})`,   // Azul
                    `rgba(16, 185, 129, ${alpha})`,   // Verde
                    `rgba(239, 68, 68, ${alpha})`,    // Vermelho
                    `rgba(245, 158, 11, ${alpha})`,   // Amarelo
                    `rgba(139, 92, 246, ${alpha})`,   // Roxo
                    `rgba(236, 72, 153, ${alpha})`,   // Rosa
                    `rgba(14, 165, 233, ${alpha})`,   // Azul claro
                    `rgba(249, 115, 22, ${alpha})`,   // Laranja
                    `rgba(6, 182, 212, ${alpha})`,    // Ciano
                    `rgba(168, 85, 247, ${alpha})`,   // Roxo claro
                ];
                
                const result = [];
                for (let i = 0; i < quantidade; i++) {
                    result.push(colors[i % colors.length]);
                }
                
                return result;
            }
            
            function criarGraficoMotivos(registros) {
                const ctx = document.getElementById('motivos-chart').getContext('2d');
                
                // Contagem de motivos
                const contagemMotivos = {};
                registros.forEach(registro => {
                    const motivo = registro.motivo;
                    contagemMotivos[motivo] = (contagemMotivos[motivo] || 0) + 1;
                });
                
                // Preparar dados para o gráfico
                const labels = Object.keys(contagemMotivos);
                const data = Object.values(contagemMotivos);
                const backgroundColor = gerarCores(labels.length);
                
                // Criar gráfico
                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColor,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((acc, val) => acc + val, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                // Salvar referência para destruir posteriormente
                document.getElementById('motivos-chart')._chart = chart;
            }
            
            function criarGraficoTempoDiario(registros) {
                const ctx = document.getElementById('tempo-diario-chart').getContext('2d');
                
                // Obter últimos 7 dias
                const hoje = new Date();
                const ultimos7Dias = [];
                for (let i = 6; i >= 0; i--) {
                    const data = new Date(hoje);
                    data.setDate(hoje.getDate() - i);
                    const dataFormatada = data.toISOString().split('T')[0];
                    ultimos7Dias.push(dataFormatada);
                }
                
                // Calcular tempo por dia
                const tempoPorDia = {};
                ultimos7Dias.forEach(dia => {
                    tempoPorDia[dia] = 0;
                });
                
                registros.forEach(registro => {
                    if (ultimos7Dias.includes(registro.data)) {
                        tempoPorDia[registro.data] += parseFloat(registro.duracao) || 0;
                    }
                });
                
                // Preparar dados para o gráfico
                const diasFormatados = ultimos7Dias.map(dia => {
                    const [ano, mes, dd] = dia.split('-');
                    return `${dd}/${mes}`;
                });
                
                const tempos = ultimos7Dias.map(dia => {
                    // Converter para horas se necessário
                    if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                        return (tempoPorDia[dia] / 60).toFixed(2);
                    }
                    return tempoPorDia[dia];
                });
                
                // Criar gráfico
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: diasFormatados,
                        datasets: [{
                            label: `Tempo de Parada (${localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'horas' : 'minutos'})`,
                            data: tempos,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'Horas' : 'Minutos'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Data'
                                }
                            }
                        }
                    }
                });
                
                // Salvar referência para destruir posteriormente
                document.getElementById('tempo-diario-chart')._chart = chart;
            }
            
            function criarGraficoOcorrencias(registros) {
                const ctx = document.getElementById('ocorrencias-chart').getContext('2d');
                
                // Contar tempo por ocorrência
                const tempoPorOcorrencia = {};
                registros.forEach(registro => {
                    const ocorrencia = registro.ocorrencia;
                    tempoPorOcorrencia[ocorrencia] = (tempoPorOcorrencia[ocorrencia] || 0) + parseFloat(registro.duracao);
                });
                
                // Ordenar por tempo (decrescente)
                const ocorrencias = Object.keys(tempoPorOcorrencia).sort((a, b) => 
                    tempoPorOcorrencia[b] - tempoPorOcorrencia[a]
                );
                
                // Limitar a 15 ocorrências para melhor visualização
                const topOcorrencias = ocorrencias.slice(0, 15);
                
                // Preparar dados para o gráfico
                const tempos = topOcorrencias.map(ocorrencia => {
                    // Converter para horas se necessário
                    if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                        return (tempoPorOcorrencia[ocorrencia] / 60).toFixed(2);
                    }
                    return tempoPorOcorrencia[ocorrencia];
                });
                
                const backgroundColor = gerarCores(topOcorrencias.length, 0.6);
                
                // Criar gráfico
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: topOcorrencias,
                        datasets: [{
                            label: `Tempo de Parada (${localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'horas' : 'minutos'})`,
                            data: tempos,
                            backgroundColor: backgroundColor,
                            borderColor: backgroundColor.map(color => color.replace(/, \d\.\d\)/, ', 1)')),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'Horas' : 'Minutos'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                // Salvar referência para destruir posteriormente
                document.getElementById('ocorrencias-chart')._chart = chart;
            }
            
            // Functions - Relatórios
            function atualizarResumoRelatorios() {
                // Obter registros para a máquina selecionada
                const registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => registro.maquina === maquinaAtiva);
                
                // Preparar registros para relatórios
                const hoje = new Date().toISOString().split('T')[0];
                
                // Dados para relatório diário (hoje)
                const registrosHoje = registros.filter(registro => registro.data === hoje);
                const totalParadasHoje = registrosHoje.length;
                let tempoTotalHoje = 0;
                registrosHoje.forEach(registro => {
                    tempoTotalHoje += parseFloat(registro.duracao) || 0;
                });
                
                // Encontrar motivo principal hoje
                const motivosHoje = {};
                registrosHoje.forEach(registro => {
                    motivosHoje[registro.motivo] = (motivosHoje[registro.motivo] || 0) + 1;
                });
                let motivoPrincipalHoje = '-';
                let maxCountHoje = 0;
                for (const [motivo, count] of Object.entries(motivosHoje)) {
                    if (count > maxCountHoje) {
                        maxCountHoje = count;
                        motivoPrincipalHoje = motivo;
                    }
                }
                
                // Formatar tempo
                const formatarTempo = (tempo) => {
                    if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                        return `${(tempo / 60).toFixed(2)} h`;
                    }
                    return `${tempo} min`;
                };
                
                // Atualizar resumo do relatório diário
                document.getElementById('relatorio-diario-paradas').textContent = totalParadasHoje;
                document.getElementById('relatorio-diario-tempo').textContent = formatarTempo(tempoTotalHoje);
                document.getElementById('relatorio-diario-motivo').textContent = motivoPrincipalHoje;
                
                // Calcular dados para relatório semanal (últimos 7 dias)
                const data7DiasAtras = new Date();
                data7DiasAtras.setDate(data7DiasAtras.getDate() - 7);
                const registrosSemana = registros.filter(registro => {
                    const dataRegistro = new Date(registro.data);
                    return dataRegistro >= data7DiasAtras;
                });
                
                const totalParadasSemana = registrosSemana.length;
                let tempoTotalSemana = 0;
                registrosSemana.forEach(registro => {
                    tempoTotalSemana += parseFloat(registro.duracao) || 0;
                });
                
                // Encontrar motivo principal semana
                const motivosSemana = {};
                registrosSemana.forEach(registro => {
                    motivosSemana[registro.motivo] = (motivosSemana[registro.motivo] || 0) + 1;
                });
                let motivoPrincipalSemana = '-';
                let maxCountSemana = 0;
                for (const [motivo, count] of Object.entries(motivosSemana)) {
                    if (count > maxCountSemana) {
                        maxCountSemana = count;
                        motivoPrincipalSemana = motivo;
                    }
                }
                
                // Atualizar resumo do relatório semanal
                document.getElementById('relatorio-semanal-paradas').textContent = totalParadasSemana;
                document.getElementById('relatorio-semanal-tempo').textContent = formatarTempo(tempoTotalSemana);
                document.getElementById('relatorio-semanal-motivo').textContent = motivoPrincipalSemana;
                
                // Calcular dados para relatório mensal (mês atual)
                const primeiroDiaMes = new Date();
                primeiroDiaMes.setDate(1);
                primeiroDiaMes.setHours(0, 0, 0, 0);
                
                const registrosMes = registros.filter(registro => {
                    const dataRegistro = new Date(registro.data);
                    return dataRegistro >= primeiroDiaMes;
                });
                
                const totalParadasMes = registrosMes.length;
                let tempoTotalMes = 0;
                registrosMes.forEach(registro => {
                    tempoTotalMes += parseFloat(registro.duracao) || 0;
                });
                
                // Encontrar motivo principal mês
                const motivosMes = {};
                registrosMes.forEach(registro => {
                    motivosMes[registro.motivo] = (motivosMes[registro.motivo] || 0) + 1;
                });
                let motivoPrincipalMes = '-';
                let maxCountMes = 0;
                for (const [motivo, count] of Object.entries(motivosMes)) {
                    if (count > maxCountMes) {
                        maxCountMes = count;
                        motivoPrincipalMes = motivo;
                    }
                }
                
                // Atualizar resumo do relatório mensal
                document.getElementById('relatorio-mensal-paradas').textContent = totalParadasMes;
                document.getElementById('relatorio-mensal-tempo').textContent = formatarTempo(tempoTotalMes);
                document.getElementById('relatorio-mensal-motivo').textContent = motivoPrincipalMes;
                
                // Preencher select de motivos para relatório personalizado
                const relatorioMotivo = document.getElementById('relatorio-motivo');
                if (relatorioMotivo.children.length <= 1) { // Só atualiza se não estiver preenchido
                    motivosCache.forEach(motivo => {
                        const option = document.createElement('option');
                        option.value = motivo.codigo;
                        option.textContent = `${motivo.codigo} - ${motivo.descricao}`;
                        relatorioMotivo.appendChild(option);
                    });
                }
                
                // Preencher select de operadores para relatório personalizado
                const relatorioOperador = document.getElementById('relatorio-operador');
                if (relatorioOperador.children.length <= 1) { // Só atualiza se não estiver preenchido
                    const operadoresUnicos = new Set();
                    registros.forEach(registro => {
                        operadoresUnicos.add(registro.operador);
                    });
                    
                    Array.from(operadoresUnicos).sort().forEach(operador => {
                        const option = document.createElement('option');
                        option.value = operador;
                        option.textContent = operador;
                        relatorioOperador.appendChild(option);
                    });
                }
                
                // Definir datas padrão para relatório personalizado
                if (!document.getElementById('relatorio-data-inicio').value) {
                    const dataInicio = new Date();
                    dataInicio.setMonth(dataInicio.getMonth() - 1);
                    document.getElementById('relatorio-data-inicio').value = dataInicio.toISOString().split('T')[0];
                    document.getElementById('relatorio-data-fim').value = new Date().toISOString().split('T')[0];
                }
            }
            
            function gerarRelatorioPersonalizado() {
                const dataInicio = document.getElementById('relatorio-data-inicio').value;
                const dataFim = document.getElementById('relatorio-data-fim').value;
                const tipo = document.getElementById('relatorio-tipo').value;
                const motivo = document.getElementById('relatorio-motivo').value;
                const operador = document.getElementById('relatorio-operador').value;
                
                if (!dataInicio || !dataFim) {
                    mostrarConfirmacao('error', 'Por favor, selecione as datas inicial e final');
                    return;
                }
                
                // Obter registros para a máquina selecionada
                let registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => registro.maquina === maquinaAtiva);
                
                // Aplicar filtros de data
                registros = registros.filter(registro => {
                    return registro.data >= dataInicio && registro.data <= dataFim;
                });
                
                // Aplicar filtro de motivo
                if (motivo) {
                    registros = registros.filter(registro => registro.codigo.startsWith(motivo + '-'));
                }
                
                // Aplicar filtro de operador
                if (operador) {
                    registros = registros.filter(registro => registro.operador === operador);
                }
                
                if (registros.length === 0) {
                    mostrarConfirmacao('error', 'Nenhum registro encontrado para os filtros selecionados');
                    return;
                }
                
                // Gerar relatório conforme tipo selecionado
                if (tipo === 'pdf') {
                    gerarRelatorioPDF(registros, { dataInicio, dataFim, motivo, operador });
                } else {
                    gerarRelatorioExcel(registros, { dataInicio, dataFim, motivo, operador });
                }
            }
            
            function exportarRelatorioDiario() {
                const hoje = new Date().toISOString().split('T')[0];
                
                // Obter registros para a máquina selecionada hoje
                const registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => registro.maquina === maquinaAtiva && registro.data === hoje);
                
                if (registros.length === 0) {
                    mostrarConfirmacao('error', 'Nenhum registro encontrado para hoje');
                    return;
                }
                
                gerarRelatorioPDF(registros, { 
                    titulo: 'Relatório Diário', 
                    dataInicio: hoje, 
                    dataFim: hoje 
                });
            }
            
            function exportarRelatorioSemanal() {
                // Calcular data de 7 dias atrás
                const dataFim = new Date().toISOString().split('T')[0];
                const dataInicio = new Date();
                dataInicio.setDate(dataInicio.getDate() - 7);
                const dataInicioStr = dataInicio.toISOString().split('T')[0];
                
                // Obter registros para a máquina selecionada na última semana
                const registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => {
                        return registro.maquina === maquinaAtiva && 
                               registro.data >= dataInicioStr && 
                               registro.data <= dataFim;
                    });
                
                if (registros.length === 0) {
                    mostrarConfirmacao('error', 'Nenhum registro encontrado para a última semana');
                    return;
                }
                
                gerarRelatorioPDF(registros, { 
                    titulo: 'Relatório Semanal', 
                    dataInicio: dataInicioStr, 
                    dataFim 
                });
            }
            
            function exportarRelatorioMensal() {
                // Calcular primeiro dia do mês
                const hoje = new Date();
                const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                const dataInicio = primeiroDiaMes.toISOString().split('T')[0];
                const dataFim = hoje.toISOString().split('T')[0];
                
                // Obter registros para a máquina selecionada no mês atual
                const registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => {
                        return registro.maquina === maquinaAtiva && 
                               registro.data >= dataInicio && 
                               registro.data <= dataFim;
                    });
                
                if (registros.length === 0) {
                    mostrarConfirmacao('error', 'Nenhum registro encontrado para o mês atual');
                    return;
                }
                
                gerarRelatorioPDF(registros, { 
                    titulo: 'Relatório Mensal', 
                    dataInicio, 
                    dataFim 
                });
            }
            
            // Functions - Exportação
            function gerarRelatorioPDF(registros, opcoes) {
                try {
                    // Criar novo documento PDF
                    const doc = new jsPDF();
                    
                    // Configurar título
                    const titulo = opcoes.titulo || `Relatório de Paradas - ${maquinaAtiva}`;
                    doc.setFontSize(18);
                    doc.setTextColor(50, 50, 50);
                    doc.text(titulo, 105, 15, { align: 'center' });
                    
                    // Adicionar informações do relatório
                    doc.setFontSize(11);
                    doc.setTextColor(100, 100, 100);
                    
                    const dataInicio = formatarDataSimples(opcoes.dataInicio);
                    const dataFim = formatarDataSimples(opcoes.dataFim);
                    
                    doc.text(`Máquina: ${maquinaAtiva}`, 14, 25);
                    doc.text(`Período: ${dataInicio} a ${dataFim}`, 14, 32);
                    
                    if (opcoes.motivo) {
                        // Encontrar descrição do motivo
                        const motivo = motivosCache.find(m => m.codigo === parseInt(opcoes.motivo));
                        if (motivo) {
                            doc.text(`Motivo: ${motivo.codigo} - ${motivo.descricao}`, 14, 39);
                        }
                    }
                    
                    if (opcoes.operador) {
                        doc.text(`Operador: ${opcoes.operador}`, 14, opcoes.motivo ? 46 : 39);
                    }
                    
                    // Adicionar data de geração
                    doc.text(`Gerado em: ${formatarDataCompleta(new Date().toISOString())}`, 14, opcoes.motivo || opcoes.operador ? 53 : 39);
                    
                    // Adicionar resumo
                    doc.setFontSize(14);
                    doc.setTextColor(59, 130, 246);
                    doc.text('Resumo', 14, opcoes.motivo || opcoes.operador ? 63 : 49);
                    
                    // Calcular totais
                    const totalParadas = registros.length;
                    let tempoTotal = 0;
                    registros.forEach(registro => {
                        tempoTotal += parseFloat(registro.duracao) || 0;
                    });
                    
                    // Formatar tempo
                    let tempoFormatado = tempoTotal;
                    const unidade = localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'horas' : 'minutos';
                    if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                        tempoFormatado = (tempoTotal / 60).toFixed(2);
                    }
                    
                    // Adicionar resumo ao PDF
                    doc.setFontSize(11);
                    doc.setTextColor(50, 50, 50);
                    doc.text(`Total de Paradas: ${totalParadas}`, 14, opcoes.motivo || opcoes.operador ? 70 : 56);
                    doc.text(`Tempo Total de Parada: ${tempoFormatado} ${unidade}`, 14, opcoes.motivo || opcoes.operador ? 77 : 63);
                    
                    // Preparar dados para a tabela
                    const tableColumn = ['Data', 'Operador', 'Código', 'Motivo', 'Ocorrência', `Duração (${unidade})`];
                    const tableRows = [];
                    
                    // Ordenar registros por data (mais recentes primeiro)
                    registros.sort((a, b) => new Date(b.data) - new Date(a.data))
                             .forEach(registro => {
                                 const dataFormatada = formatarDataSimples(registro.data);
                                 
                                 let duracaoFormatada = registro.duracao;
                                 if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                                     duracaoFormatada = (parseFloat(registro.duracao) / 60).toFixed(2);
                                 }
                                 
                                 const row = [
                                     dataFormatada,
                                     registro.operador,
                                     registro.codigo,
                                     registro.motivo.split(' - ')[1] || registro.registro.motivo,
                                     registro.ocorrencia,
                                     duracaoFormatada
                                 ];
                                 tableRows.push(row);
                             });
                    
                    // Adicionar tabela ao PDF
                    doc.autoTable({
                        head: [tableColumn],
                        body: tableRows,
                        startY: opcoes.motivo || opcoes.operador ? 85 : 70,
                        styles: {
                            fontSize: 8,
                            cellPadding: 2,
                            lineColor: [200, 200, 200]
                        },
                        headStyles: {
                            fillColor: [59, 130, 246],
                            textColor: [255, 255, 255],
                            fontStyle: 'bold'
                        },
                        alternateRowStyles: {
                            fillColor: [240, 240, 240]
                        },
                        margin: { top: 25 }
                    });
                    
                    // Adicionar rodapé
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.setTextColor(150, 150, 150);
                        const pageSize = doc.internal.pageSize;
                        const pageHeight = pageSize.height ? pageSize.height : pageSize.getHeight();
                        doc.text('Sistema de Registro de Paradas de Máquina', 105, pageHeight - 10, { align: 'center' });
                        doc.text(`Página ${i} de ${pageCount}`, pageSize.width - 20, pageHeight - 10);
                    }
                    
                    // Adicionar este relatório ao histórico
                    adicionarRelatorioAoHistorico(titulo, 'pdf');
                    
                    // Salvar o PDF
                    doc.save(`Relatorio_Paradas_${maquinaAtiva}_${formatarDataArquivo(new Date())}.pdf`);
                    
                    mostrarConfirmacao('success', 'Relatório em PDF gerado com sucesso!');
                } catch (error) {
                    console.error('Erro ao gerar PDF:', error);
                    mostrarConfirmacao('error', 'Ocorreu um erro ao gerar o PDF. Verifique o console para mais detalhes.');
                }
            }
            
            function gerarRelatorioExcel(registros, opcoes) {
                try {
                    // Preparar dados em formato adequado para o Excel
                    const dados = registros.sort((a, b) => new Date(b.data) - new Date(a.data))
                        .map(registro => {
                            let duracaoFormatada = registro.duracao;
                            if (localStorage.getItem(TIME_UNIT_KEY) === 'horas') {
                                duracaoFormatada = (parseFloat(registro.duracao) / 60).toFixed(2);
                            }
                            
                            return {
                                'Data': formatarDataSimples(registro.data),
                                'Máquina': registro.maquina,
                                'Setor': registro.setor || '-',
                                'Operador': registro.operador,
                                'Código': registro.codigo,
                                'Motivo': registro.motivo,
                                'Ocorrência': registro.ocorrencia,
                                'Duração': duracaoFormatada,
                                'Unidade': localStorage.getItem(TIME_UNIT_KEY) === 'horas' ? 'horas' : 'minutos',
                                'Observações': registro.observacoes || ''
                            };
                        });
                    
                    // Criar uma nova planilha
                    const ws = XLSX.utils.json_to_sheet(dados);
                    
                    // Configurar larguras de coluna
                    const wscols = [
                        { wch: 12 },  // Data
                        { wch: 15 },  // Máquina
                        { wch: 15 },  // Setor
                        { wch: 20 },  // Operador
                        { wch: 10 },  // Código
                        { wch: 20 },  // Motivo
                        { wch: 30 },  // Ocorrência
                        { wch: 10 },  // Duração
                        { wch: 10 },  // Unidade
                        { wch: 40 }   // Observações
                    ];
                    ws['!cols'] = wscols;
                    
                    // Criar um novo workbook e adicionar a planilha
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Registros de Paradas');
                    
                    // Registrar no histórico
                    const titulo = opcoes.titulo || `Relatório de Paradas - ${maquinaAtiva}`;
                    adicionarRelatorioAoHistorico(titulo, 'excel');
                    
                    // Gerar o arquivo e forçar o download
                    XLSX.writeFile(wb, `Relatorio_Paradas_${maquinaAtiva}_${formatarDataArquivo(new Date())}.xlsx`);
                    
                    mostrarConfirmacao('success', 'Relatório em Excel gerado com sucesso!');
                } catch (error) {
                    console.error('Erro ao gerar Excel:', error);
                    mostrarConfirmacao('error', 'Ocorreu um erro ao gerar o Excel. Verifique o console para mais detalhes.');
                }
            }
            
            function adicionarRelatorioAoHistorico(nome, tipo) {
                const historico = JSON.parse(localStorage.getItem('historico_relatorios') || '[]');
                
                // Limitar a 10 entradas mais recentes
                if (historico.length >= 10) {
                    historico.pop();
                }
                
                // Adicionar novo relatório ao início
                historico.unshift({
                    nome,
                    tipo,
                    data: new Date().toISOString()
                });
                
                localStorage.setItem('historico_relatorios', JSON.stringify(historico));
                
                // Atualizar interface se estiver na tela de relatórios
                if (!document.getElementById('section-relatorios').classList.contains('hidden')) {
                    atualizarHistoricoRelatorios();
                }
            }
            
            function atualizarHistoricoRelatorios() {
                const listaHistorico = document.getElementById('historico-relatorios');
                const semRelatorios = document.getElementById('sem-relatorios');
                
                const historico = JSON.parse(localStorage.getItem('historico_relatorios') || '[]');
                
                if (historico.length === 0) {
                    semRelatorios.style.display = 'block';
                    listaHistorico.innerHTML = '';
                    return;
                }
                
                semRelatorios.style.display = 'none';
                listaHistorico.innerHTML = '';
                
                historico.forEach((relatorio, index) => {
                    const row = document.createElement('tr');
                    
                    const tipoIcone = relatorio.tipo === 'pdf' ? 
                        '<i class="fas fa-file-pdf text-red-500 mr-1"></i>' : 
                        '<i class="fas fa-file-excel text-green-500 mr-1"></i>';
                    
                    row.innerHTML = `
                        <td class="px-4 py-3">${relatorio.nome}</td>
                        <td class="px-4 py-3">${formatarDataCompleta(relatorio.data)}</td>
                        <td class="px-4 py-3">${tipoIcone}${relatorio.tipo.toUpperCase()}</td>
                        <td class="px-4 py-3 text-right">
                            <button class="text-red-500 hover:text-red-700 btn-remover-relatorio" data-index="${index}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    
                    listaHistorico.appendChild(row);
                    
                    // Adicionar event listener para remoção
                    row.querySelector('.btn-remover-relatorio').addEventListener('click', () => {
                        removerRelatorioDoHistorico(index);
                    });
                });
            }
            
            function removerRelatorioDoHistorico(index) {
                let historico = JSON.parse(localStorage.getItem('historico_relatorios') || '[]');
                
                if (index >= 0 && index < historico.length) {
                    historico.splice(index, 1);
                    localStorage.setItem('historico_relatorios', JSON.stringify(historico));
                    
                    // Atualizar interface
                    atualizarHistoricoRelatorios();
                }
            }
            
            function exportarParaPDF() {
                const registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => registro.maquina === maquinaAtiva);
                
                if (registros.length === 0) {
                    mostrarConfirmacao('error', 'Não há registros para exportar');
                    return;
                }
                
                gerarRelatorioPDF(registros, { titulo: `Exportação de Paradas - ${maquinaAtiva}` });
            }
            
            function exportarParaExcel() {
                const registros = JSON.parse(localStorage.getItem('registros') || '[]')
                    .filter(registro => registro.maquina === maquinaAtiva);
                
                if (registros.length === 0) {
                    mostrarConfirmacao('error', 'Não há registros para exportar');
                    return;
                }
                
                gerarRelatorioExcel(registros, { titulo: `Exportação de Paradas - ${maquinaAtiva}` });
            }
            
            // Functions - Exportação e Importação de Dados
            function toggleExportDropdown() {
                document.getElementById('export-dropdown').classList.toggle('hidden');
            }
            
            function exportarDados() {
                // Preparar objeto com todos os dados a serem exportados
                const dados = {
                    versao: '1.0',
                    data: new Date().toISOString(),
                    configuracoes: {
                        unidadeTempo: localStorage.getItem(TIME_UNIT_KEY),
                        vinculacaoOperadores: localStorage.getItem(OPERATOR_BINDING_KEY),
                    },
                    maquinas: JSON.parse(localStorage.getItem('maquinas') || '[]'),
                    setores: JSON.parse(localStorage.getItem('setores') || '[]'),
                    operadores: JSON.parse(localStorage.getItem('operadores') || '[]'),
                    motivos: JSON.parse(localStorage.getItem('motivos') || '[]'),
                    ocorrencias: JSON.parse(localStorage.getItem('ocorrencias') || '[]'),
                    atribuicoes: JSON.parse(localStorage.getItem('atribuicoes') || '[]'),
                    registros: JSON.parse(localStorage.getItem('registros') || '[]')
                };
                
                // Converter objeto para JSON
                const jsonString = JSON.stringify(dados, null, 2);
                
                // Criar blob e link para download
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `dados_sistema_paradas_${formatarDataArquivo(new Date())}.json`;
                document.body.appendChild(a);
                a.click();
                
                // Limpar
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                // Esconder dropdown
                document.getElementById('export-dropdown').classList.add('hidden');
                
                mostrarConfirmacao('success', 'Dados exportados com sucesso!');
            }
            
            function importarDados() {
                document.getElementById('import-file').click();
                document.getElementById('export-dropdown').classList.add('hidden');
            }
            
            document.getElementById('import-file').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (evento) => {
                    try {
                        const dados = JSON.parse(evento.target.result);
                        
                        // Verificar se é um arquivo válido
                        if (!dados.versao || !dados.maquinas || !dados.motivos) {
                            throw new Error('Arquivo de importação inválido');
                        }
                        
                        // Confirmar importação
                        confirmarAcao(
                            'Importar Dados', 
                            'Tem certeza que deseja importar estes dados? Esta ação substituirá todos os dados atuais no sistema.',
                            () => processarImportacao(dados)
                        );
                    } catch (error) {
                        console.error('Erro ao importar dados:', error);
                        mostrarConfirmacao('error', 'O arquivo selecionado não é válido.');
                    }
                    
                    // Limpar input file
                    e.target.value = '';
                };
                reader.readAsText(file);
            });
            
            function processarImportacao(dados) {
                try {
                    showLoading('Importando dados...');
                    
                    // Configurações
                    if (dados.configuracoes) {
                        localStorage.setItem(TIME_UNIT_KEY, dados.configuracoes.unidadeTempo || 'minutos');
                        localStorage.setItem(OPERATOR_BINDING_KEY, dados.configuracoes.vinculacaoOperadores || 'false');
                    }
                    
                    // Dados básicos
                    localStorage.setItem('maquinas', JSON.stringify(dados.maquinas));
                    localStorage.setItem('setores', JSON.stringify(dados.setores));
                    localStorage.setItem('operadores', JSON.stringify(dados.operadores));
                    localStorage.setItem('motivos', JSON.stringify(dados.motivos));
                    localStorage.setItem('ocorrencias', JSON.stringify(dados.ocorrencias));
                    localStorage.setItem('atribuicoes', JSON.stringify(dados.atribuicoes));
                    
                    // Registros (preservando os registros existentes da máquina atual)
                    const registrosAtuais = JSON.parse(localStorage.getItem('registros') || '[]');
                    const registrosImportados = dados.registros || [];
                    
                    // Registros das outras máquinas + registros importados
                    const registrosAtualizados = [
                        ...registrosAtuais.filter(r => r.maquina !== maquinaAtiva),
                        ...registrosImportados.filter(r => r.maquina === maquinaAtiva)
                    ];
                    
                    localStorage.setItem('registros', JSON.stringify(registrosAtualizados));
                    
                    // Atualizar cache
                    motivosCache = dados.motivos;
                    ocorrenciasCache = dados.ocorrencias;
                    
                    // Atualizar interface
                    atualizarInterfaceConfiguracoes();
                    carregarSelecaoMaquinas();
                    carregarListaMaquinas();
                    carregarListaMotivos();
                    carregarListaOcorrencias();
                    carregarListaSetores();
                    carregarListaOperadores();
                    carregarListaAtribuicoes();
                    carregarSetoresSelect();
                    carregarMotivosSelect();
                    
                    if (maquinaAtiva) {
                        carregarRegistros();
                        if (!document.getElementById('section-dashboard').classList.contains('hidden')) {
                            atualizarDashboard();
                        }
                    }
                    
                    hideLoading();
                    mostrarConfirmacao('success', 'Dados importados com sucesso!');
                } catch (error) {
                    hideLoading();
                    console.error('Erro ao processar importação:', error);
                    mostrarConfirmacao('error', 'Ocorreu um erro ao importar os dados.');
                }
            }
            
            function confirmarResetarSistema() {
                confirmarAcao(
                    'Resetar Sistema', 
                    'ATENÇÃO! Esta ação irá apagar TODOS os dados do sistema e restaurar as configurações padrão. Esta ação NÃO pode ser desfeita. Tem certeza que deseja continuar?',
                    resetarSistema,
                    'danger'
                );
            }
            
            function resetarSistema() {
                showLoading('Resetando sistema...');
                
                try {
                    // Preservar apenas a senha de admin
                    const senhaAdmin = localStorage.getItem(ADMIN_PASSWORD_KEY);
                    
                    // Limpar todo o localStorage
                    localStorage.clear();
                    
                    // Restaurar senha de admin
                    localStorage.setItem(ADMIN_PASSWORD_KEY, senhaAdmin);
                    
                    // Restaurar configurações padrão
                    localStorage.setItem(TIME_UNIT_KEY, 'minutos');
                    localStorage.setItem(OPERATOR_BINDING_KEY, 'false');
                    
                    // Inicializar dados padrão
                    inicializarDadosPadrao();
                    
                    // Atualizar interface
                    atualizarInterfaceConfiguracoes();
                    
                    // Voltar para a tela de seleção de máquina
                    document.getElementById('painel-admin').classList.add('hidden');
                    voltarParaSelecaoMaquina();
                    
                    // Recarregar lista de máquinas
                    carregarSelecaoMaquinas();
                    
                    hideLoading();
                    mostrarConfirmacao('success', 'Sistema resetado com sucesso!');
                } catch (error) {
                    hideLoading();
                    console.error('Erro ao resetar sistema:', error);
                    mostrarConfirmacao('error', 'Ocorreu um erro ao resetar o sistema.');
                }
            }
            
            // Functions - Confirmação e Notificações
            function confirmarAcao(titulo, mensagem, callback, tipo = 'warning') {
                // Configurar modal de confirmação
                document.getElementById('confirmacao-titulo').textContent = titulo;
                document.getElementById('confirmacao-mensagem').textContent = mensagem;
                
                // Configurar botão com base no tipo de confirmação
                const btnConfirmar = document.getElementById('confirmar-confirmar');
                btnConfirmar.className = 'px-4 py-2 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-opacity-50 transition-colors premium-button';
                
                if (tipo === 'danger') {
                    btnConfirmar.classList.add('bg-red-600', 'hover:bg-red-700', 'focus:ring-red-500');
                } else { // warning
                    btnConfirmar.classList.add('bg-amber-500', 'hover:bg-amber-600', 'focus:ring-amber-500');
                }
                
                // Salvar callback
                confirmCallback = callback;
                
                // Mostrar modal
                document.getElementById('modal-confirmacao').classList.remove('hidden');
            }
            
            function fecharModalConfirmacao() {
                document.getElementById('modal-confirmacao').classList.add('hidden');
                confirmCallback = null;
            }
            
            function executarConfirmacao() {
                if (confirmCallback) {
                    confirmCallback();
                    fecharModalConfirmacao();
                }
            }
            
            function mostrarConfirmacao(tipo, mensagem) {
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg text-white flex items-center max-w-xs z-50 transform transition-all duration-300 ease-out translate-y-10 opacity-0';
                
                let icon, bgColor;
                
                if (tipo === 'success') {
                    icon = '<i class="fas fa-check-circle mr-2"></i>';
                    bgColor = 'bg-green-500';
                } else if (tipo === 'error') {
                    icon = '<i class="fas fa-exclamation-circle mr-2"></i>';
                    bgColor = 'bg-red-500';
                } else { // info ou warning
                    icon = '<i class="fas fa-info-circle mr-2"></i>';
                    bgColor = tipo === 'warning' ? 'bg-amber-500' : 'bg-blue-500';
                }
                
                toast.classList.add(bgColor);
                toast.innerHTML = `${icon}<span>${mensagem}</span>`;
                
                document.body.appendChild(toast);
                
                // Animar entrada
                setTimeout(() => {
                    toast.classList.remove('translate-y-10', 'opacity-0');
                }, 10);
                
                // Remover após 3 segundos
                setTimeout(() => {
                    toast.classList.add('translate-y-10', 'opacity-0');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            }
            
            // Functions - Formatação
            function formatarDataSimples(dataISO) {
                if (!dataISO) return '';
                
                // Formatar a data YYYY-MM-DD para DD/MM/YYYY
                const partes = dataISO.split('-');
                if (partes.length >= 3) {
                    return `${partes[2]}/${partes[1]}/${partes[0]}`;
                }
                return dataISO;
            }
            
            function formatarDataCompleta(dataISO) {
                if (!dataISO) return '';
                
                const data = new Date(dataISO);
                return data.toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            }
            
            function formatarDataArquivo(data) {
                const ano = data.getFullYear();
                const mes = String(data.getMonth() + 1).padStart(2, '0');
                const dia = String(data.getDate()).padStart(2, '0');
                const hora = String(data.getHours()).padStart(2, '0');
                const minuto = String(data.getMinutes()).padStart(2, '0');
                
                return `${ano}-${mes}-${dia}_${hora}-${minuto}`;
            }
            
            // Funções auxiliares para os selects
            function atualizarSelectsMaquinas() {
                // Atualiza selects de atribuição se estivermos usando máquinas
                if (localStorage.getItem(OPERATOR_BINDING_KEY) === 'true') {
                    const selectOrigem = document.getElementById('atribuicao-maquina-setor');
                    const filtroAtribuicoes = document.getElementById('filtro-atribuicoes');
                    
                    selectOrigem.innerHTML = '<option value="">Selecione máquina</option>';
                    filtroAtribuicoes.innerHTML = '<option value="">Todas</option>';
                    
                    const maquinas = JSON.parse(localStorage.getItem('maquinas') || '[]');
                    maquinas.forEach(maquina => {
                        const option = document.createElement('option');
                        option.value = maquina;
                        option.textContent = maquina;
                        
                        selectOrigem.appendChild(option.cloneNode(true));
                        filtroAtribuicoes.appendChild(option.cloneNode(true));
                    });
                }
            }
        });
    </script>
</body>
</html>